<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagn√≥stico M√©dico Avan√ßado com IA</title>
  <style>
    body {
      background: #0b1120;
      color: #e5e7eb;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      background: rgba(15, 23, 42, 0.9);
      padding: 16px;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 10;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav a {
      color: #22d3ee;
      text-decoration: none;
      margin-left: 16px;
      font-size: 1.1rem;
    }
    .section {
      padding: 100px 20px;
      text-align: center;
    }
    h1 {
      font-size: 2.5rem;
      color: #22d3ee;
      margin-bottom: 16px;
    }
    h2 {
      font-size: 2rem;
      color: #22d3ee;
      margin-bottom: 12px;
    }
    .form-container {
      background: rgba(31, 41, 55, 0.9);
      padding: 32px;
      border-radius: 12px;
      text-align: left;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 1.1rem;
    }
    .required::after {
      content: '*';
      color: #ef4444;
      margin-left: 4px;
    }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      background: rgba(55, 65, 81, 0.8);
      color: #fff;
      border: 2px solid #22d3ee;
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .checkbox-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      font-size: 1rem;
    }
    button {
      background: linear-gradient(45deg, #22d3ee, #4b5dfa);
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: opacity 0.2s;
    }
    button:hover {
      opacity: 0.9;
    }
    button:disabled {
      background: #6b7280;
      cursor: not-allowed;
    }
    .progress-bar {
      width: 100%;
      background: #4b5563;
      height: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .progress-fill {
      background: #22d3ee;
      height: 100%;
      border-radius: 8px;
      transition: width 0.3s;
    }
    .step-indicator {
      font-size: 1.2rem;
      color: #22d3ee;
      margin-bottom: 16px;
    }
    .instructions {
      background: rgba(45, 55, 72, 0.9);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 1rem;
      color: #d1d5db;
    }
    .error-message {
      color: #ef4444;
      font-size: 0.9rem;
      margin-top: 4px;
      display: none;
    }
    .error {
      border-color: #ef4444 !important;
    }
    .hidden {
      display: none !important;
    }
    .result-container {
      background: rgba(31, 41, 55, 0.9);
      padding: 24px;
      border-radius: 12px;
      margin-top: 24px;
      text-align: left;
    }
    footer {
      background: #0b1120;
      padding: 16px;
      text-align: center;
      color: #9ca3af;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <header>
    <nav class="container">
      <a href="#home"><img src="/assets/logo.png" alt="√Ålibis Digital" style="height: 40px;" onerror="this.src='https://via.placeholder.com/150x40?text=Logo';"></a>
      <div>
        <a href="#questionario">Diagn√≥stico M√©dico</a>
        <a href="/criar-conta.html">Criar Conta</a>
        <a href="/login.html">Login</a>
      </div>
    </nav>
  </header>

  <section id="home" class="section">
    <div class="container">
      <h1>Diagn√≥stico M√©dico Avan√ßado com IA ü©∫</h1>
      <p class="text-lg">Complete nosso question√°rio cl√≠nico detalhado para receber um pr√©-diagn√≥stico preciso, validado por m√©dicos ap√≥s pagamento.</p>
      <a href="#questionario"><button>Iniciar Agora</button></a>
    </div>
  </section>

  <section id="questionario" class="section">
    <div class="container">
      <h2>Question√°rio Cl√≠nico para Pr√©-Diagn√≥stico</h2>
      <p class="text-lg">Responda com precis√£o para obter um pr√©-diagn√≥stico t√©cnico. Todos os campos marcados com <span style="color: #ef4444;">*</span> s√£o obrigat√≥rios.</p>
      <div class="progress-bar"><div id="progress-fill" class="progress-fill" style="width: 16.67%;"></div></div>
      <p class="step-indicator">Passo <span id="current-step">1</span> de 6</p>
      <div class="form-container">
        <form id="diagnostico-form">
          <!-- Step 1: Dados Demogr√°ficos -->
          <div id="step-1" class="step active">
            <div class="instructions">
              Forne√ßa suas informa√ß√µes b√°sicas para come√ßar. Esses dados ajudam a personalizar seu pr√©-diagn√≥stico.
            </div>
            <div class="form-group">
              <label class="required" for="sexo">Sexo Biol√≥gico</label>
              <select id="sexo" required>
                <option value="">Selecione...</option>
                <option value="Masculino">Masculino</option>
                <option value="Feminino">Feminino</option>
              </select>
              <div id="sexo-error" class="error-message">Por favor, selecione uma op√ß√£o.</div>
            </div>
            <div class="form-group">
              <label class="required" for="idade">Idade (anos)</label>
              <input id="idade" type="number" min="0" max="120" placeholder="Ex.: 40" required />
              <div id="idade-error" class="error-message">Por favor, informe sua idade.</div>
            </div>
            <div class="form-group">
              <label class="required">Peso (kg) e Altura (m)</label>
              <div style="display: flex; gap: 16px;">
                <div style="flex: 1;">
                  <input id="peso" type="number" step="0.1" min="0" placeholder="Ex.: 70" required />
                  <div id="peso-error" class="error-message">Por favor, informe seu peso.</div>
                </div>
                <div style="flex: 1;">
                  <input id="altura" type="number" step="0.01" min="0" placeholder="Ex.: 1.80" required />
                  <div id="altura-error" class="error-message">Por favor, informe sua altura.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 2: Sintomas Principais -->
          <div id="step-2" class="step">
            <div class="instructions">
              Selecione at√© 5 sintomas principais que voc√™ est√° enfrentando. Forne√ßa detalhes adicionais quando solicitado.
            </div>
            <div class="form-group">
              <label class="required">Sintomas Principais (Selecione at√© 5)</label>
              <div class="checkbox-grid">
                <label><input type="checkbox" name="sintomas" value="Febre/Hipertermia"> Febre/Hipertermia</label>
                <label><input type="checkbox" name="sintomas" value="Tosse"> Tosse</label>
                <label><input type="checkbox" name="sintomas" value="Dispneia"> Dispneia (Falta de Ar)</label>
                <label><input type="checkbox" name="sintomas" value="Dor de Cabe√ßa"> Dor de Cabe√ßa</label>
                <label><input type="checkbox" name="sintomas" value="Dor Muscular"> Dor Muscular/Articular</label>
                <label><input type="checkbox" name="sintomas" value="Fadiga"> Fadiga (Cansa√ßo Extremo)</label>
                <label><input type="checkbox" name="sintomas" value="N√°usea/V√¥mito"> N√°usea/V√¥mito</label>
                <label><input type="checkbox" name="sintomas" value="Dor Abdominal"> Dor Abdominal</label>
                <label><input type="checkbox" name="sintomas" value="Manchas Cut√¢neas"> Manchas Cut√¢neas</label>
                <label><input type="checkbox" name="sintomas" value="Icter√≠cia"> Icter√≠cia</label>
                <label><input type="checkbox" name="sintomas" value="Outro"> Outro</label>
              </div>
              <div id="sintomas-error" class="error-message">Por favor, selecione pelo menos um sintoma.</div>
              <input id="sintomas-outra" type="text" class="hidden" placeholder="Especifique o sintoma" />
            </div>
            <div class="form-group hidden" id="febre-details">
              <label for="temperatura">Temperatura M√°xima (¬∞C)</label>
              <input id="temperatura" type="number" step="0.1" min="35" max="42" placeholder="Ex.: 38.5" />
            </div>
            <div class="form-group hidden" id="dor-details">
              <label for="dor-intensidade">Intensidade da Dor (0-10)</label>
              <input id="dor-intensidade" type="number" min="0" max="10" placeholder="Ex.: 7" />
            </div>
            <div class="form-group hidden" id="tosse-details">
              <label for="tosse-tipo">Tipo de Tosse</label>
              <select id="tosse-tipo">
                <option value="">Selecione...</option>
                <option value="Seca">Seca</option>
                <option value="Produtiva">Produtiva (com secre√ß√£o)</option>
              </select>
            </div>
            <div class="form-group hidden" id="dispneia-details">
              <label for="dispneia-gravidade">Gravidade da Dispneia (0-4)</label>
              <select id="dispneia-gravidade">
                <option value="0">0: Sem falta de ar</option>
                <option value="1">1: Leve, s√≥ em esfor√ßos intensos</option>
                <option value="2">2: Moderada, ao caminhar r√°pido</option>
                <option value="3">3: Grave, ao caminhar devagar</option>
                <option value="4">4: Muito grave, em repouso</option>
              </select>
            </div>
          </div>

          <!-- Step 3: Contexto dos Sintomas -->
          <div id="step-3" class="step">
            <div class="instructions">
              Descreva o contexto dos seus sintomas, incluindo dura√ß√£o e fatores relacionados.
            </div>
            <div class="form-group">
              <label class="required" for="duracao">Dura√ß√£o dos Sintomas</label>
              <select id="duracao" required>
                <option value="">Selecione...</option>
                <option value="Horas">Horas</option>
                <option value="1-3 Dias">1-3 Dias</option>
                <option value="4-7 Dias">4-7 Dias</option>
                <option value="8-14 Dias">8-14 Dias</option>
                <option value="Mais de 14 Dias">Mais de 14 Dias</option>
                <option value="Cr√¥nico">Cr√¥nico (>3 meses)</option>
              </select>
              <div id="duracao-error" class="error-message">Por favor, selecione a dura√ß√£o.</div>
            </div>
            <div class="form-group">
              <label for="desencadeantes">Fatores Desencadeantes ou Agravantes</label>
              <input id="desencadeantes" type="text" placeholder="Ex.: frio, esfor√ßo f√≠sico" />
            </div>
            <div class="form-group">
              <label for="aliviantes">Fatores Aliviantes</label>
              <input id="aliviantes" type="text" placeholder="Ex.: repouso, medicamentos" />
            </div>
            <div class="form-group">
              <label class="required" for="exposicao">Contexto de Exposi√ß√£o</label>
              <select id="exposicao" required>
                <option value="Nenhuma">Nenhuma</option>
                <option value="Viagem Internacional">Viagem Internacional</option>
                <option value="Contato com Doentes">Contato com Doentes</option>
                <option value="√Ågua Contaminada">√Ågua Contaminada (ex.: enchentes)</option>
                <option value="Animais ou Insetos">Animais ou Insetos (ex.: mosquitos)</option>
                <option value="√Årea com Surtos">√Årea com Surtos (ex.: Dengue)</option>
              </select>
              <div id="exposicao-error" class="error-message">Por favor, selecione uma op√ß√£o.</div>
            </div>
          </div>

          <!-- Step 4: Doen√ßas Cr√¥nicas -->
          <div id="step-4" class="step">
            <div class="instructions">
              Informe suas condi√ß√µes m√©dicas preexistentes e hist√≥rico de sa√∫de.
            </div>
            <div class="form-group">
              <label>Doen√ßas Cr√¥nicas</label>
              <div class="checkbox-grid">
                <label><input type="checkbox" name="cronicas" value="Nenhuma"> Nenhuma</label>
                <label><input type="checkbox" name="cronicas" value="Diabetes"> Diabetes</label>
                <label><input type="checkbox" name="cronicas" value="Hipertens√£o"> Hipertens√£o</label>
                <label><input type="checkbox" name="cronicas" value="Asma"> Asma</label>
                <label><input type="checkbox" name="cronicas" value="Doen√ßa do Cora√ß√£o"> Doen√ßa do Cora√ß√£o</label>
                <label><input type="checkbox" name="cronicas" value="Depress√£o"> Depress√£o</label>
                <label><input type="checkbox" name="cronicas" value="Enxaqueca"> Enxaqueca</label>
                <label><input type="checkbox" name="cronicas" value="Outra"> Outra</label>
              </div>
              <input id="cronicas-outra" type="text" class="hidden" placeholder="Especifique (ex.: artrite)" />
            </div>
            <div class="form-group">
              <label for="cirurgias">Cirurgias Pr√©vias</label>
              <input id="cirurgias" type="text" placeholder="Ex.: apendicectomia em 2010" />
            </div>
            <div class="form-group">
              <label for="alergias">Alergias Medicamentosas ou Ambientais</label>
              <input id="alergias" type="text" placeholder="Ex.: penicilina, p√≥len" />
            </div>
            <div class="form-group">
              <label for="medicamentos">Medicamentos em Uso</label>
              <input id="medicamentos" type="text" placeholder="Ex.: Losartana 50 mg, 1x/dia" />
            </div>
          </div>

          <!-- Step 5: Estilo de Vida -->
          <div id="step-5" class="step">
            <div class="instructions">
              Detalhe seu estilo de vida para ajudar na avalia√ß√£o do seu estado de sa√∫de.
            </div>
            <div class="form-group">
              <label class="required" for="tabagismo">Tabagismo</label>
              <select id="tabagismo" required>
                <option value="Nunca Fumou">Nunca Fumou</option>
                <option value="Ex-Fumante">Ex-Fumante</option>
                <option value="Fumante Ativo">Fumante Ativo</option>
              </select>
              <div id="tabagismo-error" class="error-message">Por favor, selecione uma op√ß√£o.</div>
              <input id="tabagismo-detalhes" type="text" class="hidden" placeholder="Ex.: 20 ma√ßos-ano" />
            </div>
            <div class="form-group">
              <label class="required" for="etilismo">Etilismo</label>
              <select id="etilismo" required>
                <option value="N√£o Bebe">N√£o Bebe</option>
                <option value="Uso Social">Uso Social</option>
                <option value="Uso Regular">Uso Regular</option>
              </select>
              <div id="etilismo-error" class="error-message">Por favor, selecione uma op√ß√£o.</div>
              <input id="etilismo-detalhes" type="text" class="hidden" placeholder="Ex.: 2 doses/semana" />
            </div>
            <div class="form-group">
              <label class="required" for="atividade-fisica">Atividade F√≠sica</label>
              <select id="atividade-fisica" required>
                <option value="Sedent√°rio">Sedent√°rio</option>
                <option value="Leve">Leve (ex.: caminhada 2x/semana)</option>
                <option value="Moderada">Moderada (ex.: academia 3-4x/semana)</option>
                <option value="Intensa">Intensa (ex.: treino di√°rio)</option>
              </select>
              <div id="atividade-fisica-error" class="error-message">Por favor, selecione uma op√ß√£o.</div>
            </div>
            <div class="form-group">
              <label for="estresse">N√≠vel de Estresse (0-5)</label>
              <input id="estresse" type="number" min="0" max="5" placeholder="0 = Nenhum, 5 = Extremo" />
            </div>
          </div>

          <!-- Step 6: Revis√£o de Sistemas -->
          <div id="step-6" class="step">
            <div class="instructions">
              Informe sintomas adicionais ou observa√ß√µes para completar sua avalia√ß√£o.
            </div>
            <div class="form-group">
              <label for="sinais-vitais">Sinais Vitais Recentes (opcional)</label>
              <input id="sinais-vitais" type="text" placeholder="Ex.: PA 130/80 mmHg, FC 72 bpm" />
            </div>
            <div class="form-group">
              <label>Sintomas Secund√°rios</label>
              <div class="checkbox-grid">
                <label><input type="checkbox" name="sintomas-secundarios" value="Perda de Paladar/Olfato"> Perda de Paladar/Olfato</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Dor de Garganta"> Dor de Garganta</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Coriza"> Coriza (Nariz Escorrendo)</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Diarreia"> Diarreia</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Tontura"> Tontura</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Perda de Peso"> Perda de Peso Involunt√°ria</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Suores Noturnos"> Suores Noturnos</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Confus√£o Mental"> Confus√£o Mental</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Tremor"> Tremor</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Tristeza Persistente"> Tristeza Persistente</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Manchas Anest√©sicas"> Manchas Anest√©sicas</label>
                <label><input type="checkbox" name="sintomas-secundarios" value="Sede Excessiva"> Sede Excessiva</label>
              </div>
            </div>
            <div class="form-group">
              <label for="observacoes">Observa√ß√µes Adicionais</label>
              <textarea id="observacoes" rows="5" placeholder="Descreva outros sintomas ou informa√ß√µes relevantes"></textarea>
            </div>
          </div>

          <div style="display: flex; justify-content: space-between; margin-top: 24px;">
            <button id="prev-step" type="button" class="hidden">Anterior</button>
            <button id="next-step" type="button" disabled>Pr√≥ximo</button>
            <button id="submit-form" type="submit" class="hidden" disabled>Enviar</button>
          </div>
        </form>

        <div id="resultado-diagnostico" class="result-container hidden">
          <h2>ü©∫ Pr√©-Diagn√≥stico Cl√≠nico</h2>
          <div id="resposta-diagnostico"></div>
          <p style="color: #9ca3af; margin-top: 16px;">‚ö†Ô∏è Este √© um pr√©-diagn√≥stico gerado por IA. N√£o substitui uma consulta m√©dica profissional. Consulte um m√©dico para um diagn√≥stico preciso.</p>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <p>¬© 2025 √Ålibis Digital. Todos os direitos reservados.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      console.log('[INIT] DOM loaded, initializing form');

      let currentStep = 1;
      const totalSteps = 6;
      const steps = document.querySelectorAll('.step');
      const prevButton = document.getElementById('prev-step');
      const nextButton = document.getElementById('next-step');
      const submitButton = document.getElementById('submit-form');
      const progressFill = document.getElementById('progress-fill');
      const currentStepText = document.getElementById('current-step');
      const form = document.getElementById('diagnostico-form');

      if (!steps.length) console.error('[ERROR] No .step elements found');
      if (!prevButton || !nextButton || !submitButton) console.error('[ERROR] Navigation buttons missing');
      if (!progressFill || !currentStepText) console.error('[ERROR] Progress elements missing');

      function updateStep() {
        console.log(`[NAV] Updating to step ${currentStep}`);
        try {
          steps.forEach((step, index) => {
            const isActive = index === currentStep - 1;
            step.classList.toggle('active', isActive);
            console.log(`[NAV] Step ${index + 1} active: ${isActive}`);
          });
          prevButton.classList.toggle('hidden', currentStep === 1);
          nextButton.classList.toggle('hidden', currentStep === totalSteps);
          submitButton.classList.toggle('hidden', currentStep !== totalSteps);
          progressFill.style.width = `${(currentStep / totalSteps) * 100}%`;
          currentStepText.textContent = currentStep;
          validateStep();
        } catch (e) {
          console.error(`[ERROR] updateStep failed: ${e.message}`);
        }
      }

      function validateStep() {
        console.log(`[VALIDATE] Validating step ${currentStep}`);
        let valid = true;
        const currentStepElement = steps[currentStep - 1];
        if (!currentStepElement) {
          console.error(`[ERROR] Step ${currentStep} element not found`);
          return false;
        }

        // Validate required inputs
        const inputs = currentStepElement.querySelectorAll('input[required], select[required]');
        inputs.forEach(input => {
          const errorElement = document.getElementById(`${input.id}-error`);
          const isValid = input.value && input.value !== '';
          if (!isValid) {
            valid = false;
            input.classList.add('error');
            if (errorElement) errorElement.style.display = 'block';
            console.log(`[VALIDATE] Input ${input.id} invalid: ${input.value}`);
          } else {
            input.classList.remove('error');
            if (errorElement) errorElement.style.display = 'none';
            console.log(`[VALIDATE] Input ${input.id} valid: ${input.value}`);
          }
        });

        // Special validation for Step 2 (checkboxes)
        if (currentStep === 2) {
          const checkedSymptoms = currentStepElement.querySelectorAll('input[name="sintomas"]:checked');
          const symptomsError = document.getElementById('sintomas-error');
          if (checkedSymptoms.length === 0) {
            valid = false;
            if (symptomsError) symptomsError.style.display = 'block';
            console.log('[VALIDATE] No symptoms selected');
          } else {
            if (symptomsError) symptomsError.style.display = 'none';
            console.log(`[VALIDATE] ${checkedSymptoms.length} symptoms selected`);
          }
        }

        nextButton.disabled = !valid;
        submitButton.disabled = !valid;
        console.log(`[VALIDATE] Step ${currentStep} valid: ${valid}, Next button disabled: ${nextButton.disabled}`);
        return valid;
      }

      // Attach input listeners for real-time validation
      steps.forEach(step => {
        step.querySelectorAll('input, select').forEach(input => {
          input.addEventListener('input', () => {
            console.log(`[INPUT] ${input.id} changed to: ${input.value}`);
            validateStep();
          });
          input.addEventListener('change', () => {
            console.log(`[CHANGE] ${input.id} changed to: ${input.value}`);
            validateStep();
          });
        });
        // Checkbox listeners for Step 2
        if (step.id === 'step-2') {
          step.querySelectorAll('input[name="sintomas"]').forEach(cb => {
            cb.addEventListener('change', validateStep);
          });
        }
      });

      prevButton.addEventListener('click', () => {
        console.log('[NAV] Previous button clicked');
        if (currentStep > 1) {
          currentStep--;
          updateStep();
        }
      });

      nextButton.addEventListener('click', () => {
        console.log('[NAV] Next button clicked');
        try {
          if (currentStep < totalSteps && validateStep()) {
            currentStep++;
            updateStep();
            console.log(`[NAV] Advanced to step ${currentStep}`);
          } else {
            console.log(`[NAV] Cannot advance: Step ${currentStep} invalid or max step reached`);
          }
        } catch (e) {
          console.error(`[ERROR] Next button click failed: ${e.message}`);
        }
      });

      submitButton.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('[SUBMIT] Submit button clicked');
        if (validateStep()) {
          processarDiagnostico();
        } else {
          console.log('[SUBMIT] Form invalid, cannot submit');
        }
      });

      // Conditional Fields
      document.querySelectorAll('input[name="sintomas"]').forEach(cb => {
        cb.addEventListener('change', () => {
          console.log(`[CONDITIONAL] Sintomas checkbox ${cb.value} changed`);
          const checked = document.querySelectorAll('input[name="sintomas"]:checked');
          if (checked.length > 5) {
            cb.checked = false;
            alert('Por favor, selecione apenas at√© 5 sintomas.');
            console.log('[CONDITIONAL] Exceeded 5 symptoms, unchecked');
          }
          document.getElementById('sintomas-outra').classList.toggle('hidden', !Array.from(checked).some(c => c.value === 'Outro'));
          document.getElementById('febre-details').classList.toggle('hidden', !Array.from(checked).some(c => c.value === 'Febre/Hipertermia'));
          document.getElementById('dor-details').classList.toggle('hidden', !Array.from(checked).some(c => ['Dor de Cabe√ßa', 'Dor Muscular', 'Dor Abdominal'].includes(c.value)));
          document.getElementById('tosse-details').classList.toggle('hidden', !Array.from(checked).some(c => c.value === 'Tosse'));
          document.getElementById('dispneia-details').classList.toggle('hidden', !Array.from(checked).some(c => c.value === 'Dispneia'));
          validateStep();
        });
      });

      document.querySelectorAll('input[name="cronicas"]').forEach(cb => {
        cb.addEventListener('change', () => {
          console.log(`[CONDITIONAL] Cr√¥nicas checkbox ${cb.value} changed`);
          const checked = document.querySelectorAll('input[name="cronicas"]:checked');
          if (cb.value === 'Nenhuma' && cb.checked) {
            checked.forEach(c => { if (c.value !== 'Nenhuma') c.checked = false; });
            document.getElementById('cronicas-outra').classList.add('hidden');
            console.log('[CONDITIONAL] Nenhuma selected, cleared others');
          } else if (checked.length > 0 && Array.from(checked).some(c => c.value !== 'Nenhuma')) {
            document.querySelector('input[name="cronicas"][value="Nenhuma"]').checked = false;
            document.getElementById('cronicas-outra').classList.toggle('hidden', !Array.from(checked).some(c => c.value === 'Outra'));
          }
          validateStep();
        });
      });

      document.getElementById('tabagismo').addEventListener('change', (e) => {
        console.log(`[CONDITIONAL] Tabagismo changed to ${e.target.value}`);
        document.getElementById('tabagismo-detalhes').classList.toggle('hidden', e.target.value === 'Nunca Fumou');
        validateStep();
      });

      document.getElementById('etilismo').addEventListener('change', (e) => {
        console.log(`[CONDITIONAL] Etilismo changed to ${e.target.value}`);
        document.getElementById('etilismo-detalhes').classList.toggle('hidden', e.target.value === 'N√£o Bebe');
        validateStep();
      });

      function processarDiagnostico() {
        console.log('[DIAG] Processing diagnosis...');
        const dados = {};
        try {
          dados.sexo = document.getElementById('sexo').value || 'N√£o informado';
          dados.idade = parseInt(document.getElementById('idade').value) || 0;
          dados.peso = parseFloat(document.getElementById('peso').value) || 0;
          dados.altura = parseFloat(document.getElementById('altura').value) || 0.1;
          dados.imc = (dados.peso / (dados.altura * dados.altura)).toFixed(1) || 0;
          dados.sintomas = Array.from(document.querySelectorAll('input[name="sintomas"]:checked')).map(c => c.value === 'Outro' ? document.getElementById('sintomas-outra').value : c.value).join(', ') || 'Nenhum';
          dados.temperatura = parseFloat(document.getElementById('temperatura').value) || 0;
          dados.dor_intensidade = parseInt(document.getElementById('dor-intensidade').value) || 0;
          dados.tosse_tipo = document.getElementById('tosse-tipo').value || 'N√£o definido';
          dados.dispneia_gravidade = parseInt(document.getElementById('dispneia-gravidade').value) || 0;
          dados.duracao = document.getElementById('duracao').value || 'N√£o informado';
          dados.desencadeantes = document.getElementById('desencadeantes').value || 'Nenhum';
          dados.aliviantes = document.getElementById('aliviantes').value || 'Nenhum';
          dados.exposicao = document.getElementById('exposicao').value || 'Nenhuma';
          dados.cronicas = Array.from(document.querySelectorAll('input[name="cronicas"]:checked')).map(c => c.value === 'Outra' ? document.getElementById('cronicas-outra').value : c.value).join(', ') || 'Nenhuma';
          dados.cirurgias = document.getElementById('cirurgias').value || 'Nenhuma';
          dados.alergias = document.getElementById('alergias').value || 'Nenhuma';
          dados.medicamentos = document.getElementById('medicamentos').value || 'Nenhum';
          dados.tabagismo = document.getElementById('tabagismo').value + (document.getElementById('tabagismo-detalhes').value ? `: ${document.getElementById('tabagismo-detalhes').value}` : '') || '';
          dados.etilismo = document.getElementById('etilismo').value + (document.getElementById('etilismo-detalhes').value ? `: ${document.getElementById('etilismo-detalhes').value}` : '') || '';
          dados.atividade = document.getElementById('atividade-fisica').value || 'N√£o informado';
          dados.estresse = parseInt(document.getElementById('estresse').value) || 0;
          dados.sinais_vitais = document.getElementById('sinais-vitais').value || 'N√£o informado';
          dados.sintomas_secundarios = Array.from(document.querySelectorAll('input[name="sintomas-secundarios"]:checked')).map(c => c.value).join(', ') || 'Nenhum';
          dados.observacoes = document.getElementById('observacoes').value || 'Nenhuma';
        } catch (e) {
          console.error(`[ERROR] Data collection failed: ${e.message}`);
          return;
        }

        // Scoring system for diagnoses
        let scores = {
          influenza: 0,
          covid19: 0,
          bronchitis: 0,
          dengue: 0,
          tension_headache: 0
        };

        try {
          if (dados.sintomas.includes('Febre/Hipertermia')) {
            scores.influenza += 30;
            scores.covid19 += 25;
            scores.dengue += 25;
            scores.bronchitis += 15;
            if (dados.temperatura >= 38) {
              scores.influenza += 20;
              scores.covid19 += 10;
              scores.dengue += 15;
            }
          }
          if (dados.sintomas.includes('Tosse')) {
            scores.influenza += 20;
            scores.covid19 += 25;
            scores.bronchitis += 30;
            if (dados.tosse_tipo === 'Seca') {
              scores.covid19 += 15;
              scores.influenza += 10;
            } else if (dados.tosse_tipo === 'Produtiva') {
              scores.bronchitis += 20;
            }
          }
          if (dados.sintomas.includes('Dor de Cabe√ßa')) {
            scores.influenza += 15;
            scores.covid19 += 10;
            scores.dengue += 20;
            scores.tension_headache += 30;
            if (dados.dor_intensidade >= 7) {
              scores.tension_headache += 10;
              scores.dengue += 10;
            }
          }
          if (dados.sintomas.includes('Dor Muscular')) {
            scores.influenza += 25;
            scores.covid19 += 15;
            scores.dengue += 20;
            scores.tension_headache += 10;
          }
          if (['1-3 Dias', '4-7 Dias'].includes(dados.duracao)) {
            scores.influenza += 10;
            scores.covid19 += 10;
            scores.dengue += 10;
          }
          if (dados.exposicao === 'Contato com Doentes') {
            scores.influenza += 15;
            scores.covid19 += 15;
            scores.bronchitis += 10;
          }
          if (dados.exposicao === '√Årea com Surtos') {
            scores.dengue += 15;
          }

          console.log('[DIAG] Scores:', scores);

          // Generate diagnosis output
          const possiveisDiagnosticos = [];
          if (scores.influenza >= 50) {
            possiveisDiagnosticos.push({
              nome: 'Influenza (Gripe)',
              probabilidade: Math.min(90, scores.influenza),
              recomendacao: 'Repouse, mantenha-se hidratado e considere medicamentos antivirais (ex.: oseltamivir) sob orienta√ß√£o m√©dica. Monitore a febre e procure atendimento se persistir por mais de 4 dias.'
            });
          }
          if (scores.covid19 >= 50) {
            possiveisDiagnosticos.push({
              nome: 'COVID-19',
              probabilidade: Math.min(85, scores.covid19),
              recomendacao: 'Realize um teste PCR ou ant√≠geno imediatamente. Isole-se e contate um servi√ßo de sa√∫de. Monitore oxigena√ß√£o e sintomas respirat√≥rios.'
            });
          }
          if (scores.dengue >= 50) {
            possiveisDiagnosticos.push({
              nome: 'Dengue',
              probabilidade: Math.min(80, scores.dengue),
              recomendacao: 'Procure um m√©dico para exames de sangue (hemograma) e avalia√ß√£o de plaquetas. Hidrate-se bem e evite medicamentos como aspirina.'
            });
          }
          if (scores.bronchitis >= 50) {
            possiveisDiagnosticos.push({
              nome: 'Bronquite',
              probabilidade: Math.min(70, scores.bronchitis),
              recomendacao: 'Consulte um pneumologista para avalia√ß√£o. Evite irritantes respirat√≥rios e considere medicamentos para aliviar a tosse.'
            });
          }
          if (scores.tension_headache >= 40) {
            possiveisDiagnosticos.push({
              nome: 'Cefaleia Tensional',
              probabilidade: Math.min(60, scores.tension_headache),
              recomendacao: 'Tente relaxar, hidrate-se e utilize medicamentos adequados (ex.: paracetamol) se necess√°rio. Consulte um m√©dico se a dor persistir.'
            });
          }

          possiveisDiagnosticos.sort((a, b) => b.probabilidade - a.probabilidade);

          let output = `
            <h3 class="text-lg font-bold mb-3">Resumo dos Dados</h3>
            <ul class="list-disc pl-6 mb-4">
              <li><strong>Sexo:</strong> ${dados.sexo}</li>
              <li><strong>Idade:</strong> ${dados.idade} anos</li>
              <li><strong>Peso:</strong> ${dados.peso} kg</li>
              <li><strong>Altura:</strong> ${dados.altura} m</li>
              <li><strong>IMC:</strong> ${dados.imc} (Normal)</li>
              <li><strong>Sintomas:</strong> ${dados.sintomas}</li>
            </ul>
            <h3 class="text-lg font-bold mb-3">Poss√≠veis Diagn√≥sticos</h3>
            <ul class="list-decimal pl-6">
          `;
          if (possiveisDiagnosticos.length === 0) {
            output += '<li>Nenhum diagn√≥stico prov√°vel identificado. Consulte um m√©dico para avalia√ß√£o detalhada.</li>';
          } else {
            possiveisDiagnosticos.forEach(diag => {
              output += `
                <li class="mb-2">
                  <strong>${diag.nome}</strong> (Probabilidade aproximada: ${diag.probabilidade}%)<br/>
                  <span>${diag.recomendacao}</span>
                </li>
              `;
            });
          }
          output += '</ul>';

          document.getElementById('resposta-diagnostico').innerHTML = output;
          document.getElementById('resultado-diagnostico').classList.remove('hidden');
          console.log('[DIAG] Diagnosis displayed');
        } catch (error) {
          console.error(`[ERROR] Diagnosis processing failed: ${error.message}`);
        }
      }

      // Initialize
      console.log('[INIT] Starting form initialization');
      updateStep();
      console.log('[INIT] Form initialized successfully');
    });
  </script>
</body>
</html>
