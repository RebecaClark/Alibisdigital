<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="√ìRBITA Qu√¢ntica - Autocuidado completo">
    <meta name="keywords" content="√ìRBITA, autocuidado, medita√ß√£o, sa√∫de mental, bem-estar">
    <meta name="author" content="√Ålibis Digital">
    <title>√ìRBITA Qu√¢ntica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap">
    <style>
        body { margin: 0; padding: 0; min-height: 100vh; font-family: 'Inter', sans-serif; color: #e5e7eb; background: linear-gradient(135deg, #0b1120, #1e1b4b); overflow-x: hidden; }
        #particles-js { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; background: transparent; }
        .fade-in { animation: fadeIn 0.8s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .header { position: sticky; top: 0; width: 100%; height: 40px; background: rgba(17, 24, 39, 0.9); backdrop-filter: blur(10px); padding: 5px 10px; z-index: 10; display: flex; justify-content: space-between; align-items: center; }
        .header img { height: 25px; width: auto; }
        .nav-btn { color: #e5e7eb; font-size: 1rem; background: none; border: none; cursor: pointer; }
        .nav-btn:hover { color: #22d3ee; }
        .content { margin-top: 50px; padding: 10px; }
        .card { background: linear-gradient(45deg, #0a1f2e, #00ccff); border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 0 10px rgba(0, 212, 255, 0.3); backdrop-filter: blur(5px); }
        .futuristic-btn { background: linear-gradient(45deg, #7C3AED, #22d3ee); color: #fff; padding: 10px 20px; border-radius: 25px; font-size: 0.9rem; font-weight: 600; box-shadow: 0 0 5px #22d3ee; transition: transform 0.3s; }
        .futuristic-btn:hover { transform: translateY(-2px); }
        .futuristic-btn:active { transform: scale(0.95); }
        .futuristic-btn:disabled { background: #666; cursor: not-allowed; }
        .progress-bar { width: 100%; background: #1a1a1a; border-radius: 5px; overflow: hidden; margin-top: 10px; }
        .progress { height: 6px; background: #22d3ee; width: 0; transition: width 0.3s ease; }
        .loading-dots::after { content: ''; display: inline-block; width: 0.8em; height: 0.8em; animation: dots 1.5s steps(3, end) infinite; }
        @keyframes dots { 0% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } 100% { content: '.'; } }
        video { width: 100%; max-width: 320px; border: 2px solid #22d3ee; border-radius: 10px; }
        @media (max-width: 768px) { .header { height: 35px; padding: 3px 8px; } .header img { height: 20px; } .content { margin-top: 45px; } }
    </style>
</head>
<body>
    <div id="particles-js"></div>

    <!-- Cabe√ßalho -->
    <header class="header">
        <a href="/"><img src="/assets/logo.png" alt="Logo √ìRBITA" class="fade-in"></a>
        <button class="nav-btn" id="menu-btn">‚ò∞</button>
    </header>

    <!-- Conte√∫do Principal -->
    <div class="content">
        <div class="card fade-in">
            <h2 class="text-xl font-semibold mb-2">Monitoramento Emocional</h2>
            <p class="text-gray-300 mb-4">Acompanhe seu estado emocional.</p>
            <video id="video" autoplay muted class="mt-2 hidden"></video>
            <button id="scan-btn" class="futuristic-btn mt-4 w-full" disabled>Escanear Agora</button>
            <div id="scan-result" class="mt-4 hidden"></div>
        </div>
        <div class="card fade-in">
            <h2 class="text-xl font-semibold mb-2">Ciclo Di√°rio</h2>
            <p class="text-gray-300 mb-4">Monitore h√°bitos e progresso.</p>
            <div id="daily-suggestions" class="mt-2">
                <p class="text-gray-400">Escanear para sugest√µes!</p>
            </div>
            <button id="habit-log-btn" class="futuristic-btn mt-2 w-full">Registrar H√°bito</button>
            <div id="progress-display" class="mt-2 text-gray-300 hidden">Progresso: 0 h√°bitos</div>
        </div>
        <div class="card fade-in">
            <h2 class="text-xl font-semibold mb-2">Bem-Estar e Relaxamento</h2>
            <p class="text-gray-300 mb-4">Ferramentas para estresse e sono.</p>
            <select id="meditation-type" class="futuristic-btn w-full mb-2 text-left p-2 bg-transparent border-none">
                <option value="anxiety">Medita√ß√£o para Ansiedade</option>
                <option value="insomnia">Medita√ß√£o para Ins√¥nia</option>
                <option value="focus">Medita√ß√£o para Foco</option>
            </select>
            <button id="meditation-btn" class="futuristic-btn w-full">üßò Iniciar Medita√ß√£o</button>
            <button id="sleep-story-btn" class="futuristic-btn w-full mt-2">üåô Hist√≥ria para Dormir</button>
            <button id="stretch-btn" class="futuristic-btn w-full mt-2">ü§∏ Alongamento</button>
            <button id="breath-btn" class="futuristic-btn w-full mt-2">üå¨ Respira√ß√£o</button>
            <button id="sound-btn" class="futuristic-btn w-full mt-2">üé∂ Sons Relaxantes</button>
        </div>
        <div class="card fade-in">
            <h2 class="text-xl font-semibold mb-2">Comunidade √ìrbita</h2>
            <p class="text-gray-300 mb-4">Conecte-se e receba apoio.</p>
            <button id="community-btn" class="futuristic-btn w-full">Entrar na Comunidade</button>
        </div>
    </div>

    <canvas id="canvas" width="320" height="240" style="display: none;"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        // Inicializar particles.js
        particlesJS('particles-js', {
            particles: { number: { value: 50, density: { enable: true, value_area: 600 } }, color: { value: '#22d3ee' }, shape: { type: 'circle' }, opacity: { value: 0.2, random: true }, size: { value: 1.5, random: true }, line_linked: { enable: true, distance: 80, color: '#22d3ee', opacity: 0.15, width: 0.5 }, move: { enable: true, speed: 0.8 } },
            interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true }, modes: { repulse: { distance: 80 }, push: { particles_nb: 2 } } }
        });

        let dailyData = [];
        let habitCount = 0;

        const video = document.getElementById('video');
        const scanBtn = document.getElementById('scan-btn');
        const scanResult = document.getElementById('scan-result');
        const dailySuggestions = document.getElementById('daily-suggestions');
        const habitLogBtn = document.getElementById('habit-log-btn');
        const progressDisplay = document.getElementById('progress-display');
        const meditationBtn = document.getElementById('meditation-btn');
        const sleepStoryBtn = document.getElementById('sleep-story-btn');
        const stretchBtn = document.getElementById('stretch-btn');
        const breathBtn = document.getElementById('breath-btn');
        const soundBtn = document.getElementById('sound-btn');
        const communityBtn = document.getElementById('community-btn');
        const menuBtn = document.getElementById('menu-btn');
        const meditationType = document.getElementById('meditation-type');
        let cameraInitialized = false;

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
                cameraInitialized = true;
                video.classList.remove('hidden');
                scanBtn.disabled = false;
            })
            .catch(err => {
                console.error('Erro na c√¢mera:', err.message);
                scanResult.classList.remove('hidden');
                scanResult.innerHTML = '<p class="fade-in text-red-500">‚ùå C√¢mera n√£o acessada. Verifique permiss√µes.</p>';
            });

        scanBtn.addEventListener('click', startScan);
        menuBtn.addEventListener('click', () => alert('Menu (simula√ß√£o)'));
        communityBtn.addEventListener('click', () => alert('Comunidade (simula√ß√£o)'));
        habitLogBtn.addEventListener('click', logHabit);
        meditationBtn.addEventListener('click', startMeditation);
        sleepStoryBtn.addEventListener('click', playSleepStory);
        stretchBtn.addEventListener('click', startStretch);
        breathBtn.addEventListener('click', startBreathing);
        soundBtn.addEventListener('click', playSounds);

        async function startScan() {
            scanBtn.disabled = true;
            scanResult.classList.remove('hidden');
            scanResult.innerHTML = '<p class="fade-in text-white">Escanando...<span class="loading-dots"></span></p><div class="progress-bar"><div id="progress" class="progress"></div></div>';

            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            const progress = document.getElementById('progress');

            let progressWidth = 0;
            const interval = setInterval(() => {
                progressWidth += 20;
                progress.style.width = `${progressWidth}%`;
                if (progressWidth >= 100) clearInterval(interval);
            }, 400);

            try {
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                const emotion = simulateEmotion();
                const bpm = simulateHeartRate();
                displayScanResult(emotion, bpm);
                updateDaily(emotion, bpm);
            } catch (error) {
                console.error('Erro:', error.message);
                scanResult.innerHTML = '<p class="fade-in text-red-500">‚ùå Erro: ' + error.message + '</p>';
            } finally {
                scanBtn.disabled = false;
                progress.style.width = '0';
            }
        }

        function simulateEmotion() {
            const emotions = ['happiness', 'sadness', 'anger', 'neutral', 'fear'];
            return emotions[Math.floor(Math.random() * emotions.length)];
        }

        function simulateHeartRate() {
            return Math.round(60 + Math.random() * 40);
        }

        function displayScanResult(emotion, bpm) {
            const diagnosisMap = {
                happiness: { text: "Energia positiva! üåü", suggestion: "Respire fundo e caminhe." },
                sadness: { text: "Energia baixa‚Ä¶ reabaste√ßa! ‚úàÔ∏è", suggestion: "Tente medita√ß√£o ou di√°rio." },
                anger: { text: "Tens√£o‚Ä¶ vulc√£o ativo! üåã", suggestion: "Fa√ßa respira√ß√£o 4-4-4." },
                neutral: { text: "Campo neutro‚Ä¶ equil√≠brio! ‚öñÔ∏è", suggestion: "Alongue-se ou medite." },
                fear: { text: "Mente em √≥rbita‚Ä¶ desacelere! üèéÔ∏è", suggestion: "Ou√ßa sons relaxantes." }
            };
            const diag = diagnosisMap[emotion] || diagnosisMap.neutral;
            const bpmContext = bpm >= 60 && bpm <= 100 ? 'est√°vel' : bpm > 100 ? 'alta, relaxe' : 'baixa, consulte um m√©dico';

            scanResult.innerHTML = `
                <h3 class="text-lg font-semibold mb-2">üß† Estado Qu√¢ntico</h3>
                <p class="fade-in">${diag.text}</p>
                <h3 class="text-lg font-semibold mt-2 mb-2">üíì Frequ√™ncia</h3>
                <p class="fade-in">Frequ√™ncia: ${bpm} bpm, ${bpmContext}.</p>
                <h3 class="text-lg font-semibold mt-2 mb-2">üåå Sugest√£o</h3>
                <p class="fade-in text-gray-300">${diag.suggestion}</p>
                <button id="retry-btn" class="futuristic-btn mt-2 w-full">üîÑ Reiniciar</button>
            `;
            document.getElementById('retry-btn').addEventListener('click', startScan);
        }

        function updateDaily(emotion, bpm) {
            dailyData.push({ time: new Date().toLocaleTimeString(), emotion, bpm });
            if (dailyData.length > 5) dailyData.shift();
            const suggestions = {
                happiness: "Mantenha o √¢nimo √†s 16h!",
                sadness: "Medite √†s 18h.",
                anger: "Respire √†s 15h.",
                neutral: bpm > 90 ? "Relaxe √†s 17h." : "Caminhe √†s 16h.",
                fear: "Calma √†s 16h."
            };
            dailySuggestions.innerHTML = `<p class="text-gray-300">${suggestions[emotion] || 'Monitore mais!'}</p>`;
        }

        function logHabit() {
            const habit = prompt('Digite um h√°bito (ex.: 30 min de exerc√≠cio):');
            if (habit) {
                habitCount++;
                progressDisplay.classList.remove('hidden');
                progressDisplay.textContent = `Progresso: ${habitCount} h√°bitos`;
                alert(`H√°bito "${habit}" registrado √†s ${new Date().toLocaleTimeString()}!`);
            }
        }

        function startMeditation() {
            const type = meditationType.value;
            const meditations = {
                anxiety: '5 min de respira√ß√£o para ansiedade',
                insomnia: '10 min de relaxamento para ins√¥nia',
                focus: '15 min de mindfulness para foco'
            };
            alert(`Iniciando ${meditations[type]}. Feche os olhos e respire...`);
        }

        function playSleepStory() {
            const stories = ['Hist√≥ria da Floresta Tranquila', 'Viagem √†s Estrelas'];
            const selected = stories[Math.floor(Math.random() * stories.length)];
            alert(`Iniciando ${selected}. Relaxe e durma...`);
        }

        function startStretch() {
            alert('Iniciando alongamento de 5 min. Estique bra√ßos e pernas lentamente...');
        }

        function startBreathing() {
            alert('T√©cnica 4-4-4: Inspire por 4s, segure por 4s, expire por 4s. Repita 5x.');
        }

        function playSounds() {
            const sounds = ['Chuva', 'Ondas do Mar', 'Ru√≠do Branco'];
            const selected = sounds[Math.floor(Math.random() * sounds.length)];
            alert(`Tocando ${selected}. Aproveite para relaxar...`);
        }
    </script>
</body>
</html>
