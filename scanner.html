<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scanner Emocional | MedAI Brasil</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #111827, #1F2937);
      color: white;
    }
    .glass-card {
      background: rgba(17, 24, 39, 0.85);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
    }
    #videoElement {
      border-radius: 8px;
      border: 2px solid #3B82F6;
    }
    #overlayCanvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <header class="glass-card fixed top-0 left-0 w-full z-50 shadow-lg p-4">
    <div class="flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <span class="text-xl font-bold">Scanner Emocional</span>
      </div>
    </div>
  </header>

  <main class="pt-20 pb-16 px-4 max-w-7xl mx-auto">
    <section class="glass-card p-6 my-8">
      <h2 class="text-2xl font-bold mb-6">Scanner Emocional</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <div class="relative" style="width: 100%; max-width: 500px; margin: 0 auto;">
            <video id="videoElement" autoplay muted playsinline class="w-full"></video>
            <canvas id="overlayCanvas" class="absolute top-0 left-0 w-full h-full"></canvas>
          </div>
          <button id="startBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg mt-4 w-full">
            Iniciar Análise
          </button>
        </div>
        
        <div>
          <div class="glass-card p-4 mb-4">
            <h3 class="font-semibold mb-2">Emoção Detectada:</h3>
            <div id="emotion-result" class="flex items-center">
              <div id="emotion-dot" class="w-4 h-4 rounded-full mr-2 bg-gray-500"></div>
              <span id="emotion-text">Aguardando análise...</span>
            </div>
            <div class="mt-2 h-2 bg-gray-700 rounded-full overflow-hidden">
              <div id="intensityBar" class="h-full bg-blue-500" style="width: 0%"></div>
            </div>
          </div>
          
          <div class="glass-card p-4 mb-4">
            <h3 class="font-semibold mb-2">Diagnóstico:</h3>
            <div id="diagnosis-result">
              <p class="text-gray-300">Nenhum diagnóstico disponível ainda.</p>
            </div>
          </div>
          
          <div class="glass-card p-4">
            <h3 class="font-semibold mb-2">Recomendações:</h3>
            <div id="recommendations">
              <p class="text-gray-300">Inicie a análise para receber recomendações personalizadas.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Elementos DOM
    const videoElement = document.getElementById('videoElement');
    const startBtn = document.getElementById('startBtn');
    const emotionText = document.getElementById('emotion-text');
    const emotionDot = document.getElementById('emotion-dot');
    const intensityBar = document.getElementById('intensityBar');
    const diagnosisResult = document.getElementById('diagnosis-result');
    const recommendations = document.getElementById('recommendations');

    // Modelo de emoções
    const emotions = {
      happy: { 
        label: 'Felicidade', 
        color: '#f59e0b', 
        diagnosis: 'Estado emocional positivo detectado',
        recommendations: [
          "Continue cultivando atividades que trazem felicidade",
          "Compartilhar sua felicidade pode fortalecer relacionamentos",
          "Visite <a href='https://medaibrasil.com.br/apoio-emocional' class='text-blue-400' target='_blank'>apoio emocional</a> para manter esse estado"
        ]
      },
      sad: { 
        label: 'Tristeza', 
        color: '#3b82f6',
        diagnosis: 'Sinais de tristeza ou melancolia detectados',
        recommendations: [
          "Pratique atividades que elevem seu humor",
          "Fale com alguém de confiança sobre seus sentimentos",
          "Acesse <a href='https://medaibrasil.com.br/apoio-emocional' class='text-blue-400' target='_blank'>recursos de apoio</a>"
        ]
      },
      neutral: { 
        label: 'Neutro', 
        color: '#64748b',
        diagnosis: 'Estado emocional equilibrado',
        recommendations: [
          "Mantenha uma rotina de autocuidado",
          "Pratique mindfulness para manter o equilíbrio"
        ]
      }
    };

    // Estados
    let isScanning = false;
    let analysisInterval;

    // Inicializar câmera
    async function initCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        videoElement.srcObject = stream;
      } catch (err) {
        console.error("Erro ao acessar a câmera:", err);
        alert("Não foi possível acessar a câmera. Por favor, verifique as permissões.");
      }
    }

    // Iniciar/parar análise
    startBtn.addEventListener('click', function() {
      if (isScanning) {
        stopAnalysis();
      } else {
        startAnalysis();
      }
    });

    // Iniciar análise
    function startAnalysis() {
      isScanning = true;
      startBtn.textContent = 'Parar Análise';
      startBtn.classList.remove('bg-blue-500');
      startBtn.classList.add('bg-red-500');
      
      // Iniciar simulação de análise
      analysisInterval = setInterval(generateAnalysisResults, 2000);
    }

    // Parar análise
    function stopAnalysis() {
      isScanning = false;
      startBtn.textContent = 'Iniciar Análise';
      startBtn.classList.add('bg-blue-500');
      startBtn.classList.remove('bg-red-500');
      
      clearInterval(analysisInterval);
    }

    // Gerar resultados de análise (simulação)
    function generateAnalysisResults() {
      // Selecionar emoção aleatória para simulação
      const emotionKeys = Object.keys(emotions);
      const randomEmotionKey = emotionKeys[Math.floor(Math.random() * emotionKeys.length)];
      const emotion = emotions[randomEmotionKey];
      const confidence = Math.random() * 0.5 + 0.5; // Entre 50% e 100%
      
      // Atualizar UI
      emotionDot.style.backgroundColor = emotion.color;
      emotionText.textContent = emotion.label;
      intensityBar.style.width = `${confidence * 100}%`;
      intensityBar.style.backgroundColor = emotion.color;
      
      // Mostrar diagnóstico
      diagnosisResult.innerHTML = `
        <p>${emotion.diagnosis}</p>
        <p class="text-sm text-gray-400 mt-1">Confiança: ${Math.round(confidence * 100)}%</p>
      `;
      
      // Mostrar recomendações
      recommendations.innerHTML = emotion.recommendations.map(r => 
        `<div class="flex items-start mb-2">
          <div class="mt-1 mr-2">•</div>
          <div>${r}</div>
        </div>`
      ).join('');
    }

    // Inicializar
    window.addEventListener('DOMContentLoaded', function() {
      initCamera();
    });
  </script>
</body>
</html>
