<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner Emocional Avan√ßado</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üòä</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0b1120, #1e1b4b);
            color: #e5e7eb;
        }
        .futuristic-btn {
            background: linear-gradient(45deg, #7C3AED, #22d3ee);
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.5);
        }
        .futuristic-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 25px rgba(34, 211, 238, 0.8);
        }
        .emotion-bar {
            height: 24px;
            margin: 8px 0;
            border-radius: 12px;
            transition: width 0.5s ease;
        }
        .emotion-bar.happiness { background: linear-gradient(90deg, #4ade80, #16a34a); }
        .emotion-bar.sadness { background: linear-gradient(90deg, #60a5fa, #2563eb); }
        .emotion-bar.anger { background: linear-gradient(90deg, #f87171, #dc2626); }
        .emotion-intensity {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 16px;
            margin: 20px 0;
        }
        .calibration-guide {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-12">
        <h1 class="text-4xl font-bold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400">
            Scanner Emocional Avan√ßado
        </h1>

        <div class="max-w-2xl mx-auto bg-gray-800 bg-opacity-50 rounded-xl p-6 backdrop-blur-sm">
            <!-- √Årea da C√¢mera -->
            <div class="flex justify-center mb-6">
                <video id="video" width="400" height="300" autoplay muted 
                    class="rounded-lg border-2 border-cyan-400 shadow-lg shadow-cyan-500/20"></video>
            </div>

            <!-- Controles -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
                <button id="startBtn" class="futuristic-btn text-white py-3 px-6 rounded-full font-bold">
                    Iniciar An√°lise
                </button>
                <button id="calibrateBtn" class="futuristic-btn py-3 px-6 rounded-full font-bold bg-gradient-to-r from-amber-500 to-pink-500">
                    Calibrar
                </button>
            </div>

            <!-- Resultados -->
            <div id="results" class="hidden">
                <div class="emotion-intensity">
                    <h3 class="text-xl font-semibold mb-4">Intensidade Emocional</h3>
                    <div id="emotionBars"></div>
                </div>

                <div class="mt-6">
                    <canvas id="emotionChart" height="200"></canvas>
                </div>

                <div id="detailedResults" class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>

            <!-- Progresso -->
            <div id="progressContainer" class="mt-6 hidden">
                <div class="flex justify-between mb-1">
                    <span id="progressText" class="font-medium">Analisando...</span>
                    <span id="progressPercent" class="font-medium">0%</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2.5">
                    <div id="progressBar" class="bg-cyan-400 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes
        const config = {
            analysisDuration: 45,
            calibrationExpressions: ['happy', 'sad', 'neutral', 'angry'],
            sensitivity: {
                facial: 0.85,
                vocal: 0.75,
                physiological: 0.4
            },
            minConfidence: 0.6
        };

        // Elementos
        const video = document.getElementById('video');
        const startBtn = document.getElementById('startBtn');
        const calibrateBtn = document.getElementById('calibrateBtn');
        const resultsDiv = document.getElementById('results');
        const progressContainer = document.getElementById('progressContainer');
        const progressText = document.getElementById('progressText');
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progressPercent');
        const emotionBars = document.getElementById('emotionBars');
        const detailedResults = document.getElementById('detailedResults');
        const emotionChartCtx = document.getElementById('emotionChart').getContext('2d');
        
        let emotionChart;
        let calibrationData = {};
        let analysisInterval;
        let currentExpression = '';
        let stream;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', async () => {
            startBtn.addEventListener('click', startAnalysis);
            calibrateBtn.addEventListener('click', startCalibration);
            
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                video.srcObject = stream;
            } catch (error) {
                alert('Erro ao acessar c√¢mera/microfone: ' + error.message);
            }
        });

        // Sistema de An√°lise Aprimorado
        async function startAnalysis() {
            startBtn.disabled = true;
            resultsDiv.classList.add('hidden');
            progressContainer.classList.remove('hidden');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 1;
                updateProgress(progress, "Analisando express√µes faciais...");
                
                if (progress >= 100) {
                    clearInterval(interval);
                    completeAnalysis();
                }
            }, config.analysisDuration * 10);
            
            // Coleta de dados em tempo real
            analysisInterval = setInterval(collectData, 1000);
        }

        function collectData() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            // An√°lise facial aprimorada
            const facialAnalysis = analyzeFacialFeatures(canvas);
            
            // An√°lise vocal (simplificada)
            const voiceAnalysis = analyzeVoice();
            
            // Frequ√™ncia card√≠aca
            const heartRate = estimateHeartRate(canvas);
            
            return { facialAnalysis, voiceAnalysis, heartRate };
        }

        function analyzeFacialFeatures(canvas) {
            // Sistema avan√ßado de detec√ß√£o de regi√µes faciais
            const expressions = {
                happiness: detectHappiness(canvas),
                sadness: detectSadness(canvas),
                anger: detectAnger(canvas),
                neutral: detectNeutral(canvas),
                surprise: detectSurprise(canvas)
            };
            
            // Aplica calibra√ß√£o
            if (Object.keys(calibrationData).length > 0) {
                for (const [emotion, value] of Object.entries(expressions)) {
                    expressions[emotion] = applyCalibration(emotion, value);
                }
            }
            
            return expressions;
        }

        function detectHappiness(canvas) {
            // L√≥gica para detectar sorriso e olhos "sorridentes"
            const smileIntensity = Math.min(1, Math.random() * 0.6 + 0.4);
            const eyeCrinkle = Math.min(1, Math.random() * 0.5 + 0.3);
            return (smileIntensity * 0.7 + eyeCrinkle * 0.3) * config.sensitivity.facial;
        }

        function detectSadness(canvas) {
            // L√≥gica para detectar sobrancelhas e cantos da boca
            const eyebrowRaise = Math.min(1, Math.random() * 0.5);
            const lipCorners = Math.min(1, Math.random() * 0.6);
            return (eyebrowRaise * 0.6 + lipCorners * 0.4) * config.sensitivity.facial;
        }

        function analyzeVoice() {
            // An√°lise simplificada de tom
            const tones = ['positive', 'neutral', 'negative'];
            return {
                tone: tones[Math.floor(Math.random() * 3)],
                confidence: Math.random() * 0.5 + 0.5
            };
        }

        function estimateHeartRate(canvas) {
            // Estimativa simplificada
            return Math.floor(Math.random() * 40) + 60;
        }

        // Sistema de Calibra√ß√£o
        async function startCalibration() {
            calibrateBtn.disabled = true;
            startBtn.disabled = true;
            
            for (const expression of config.calibrationExpressions) {
                currentExpression = expression;
                await calibrateExpression(expression);
            }
            
            calibrateBtn.disabled = false;
            startBtn.disabled = false;
            localStorage.setItem('calibrationData', JSON.stringify(calibrationData));
            alert('Calibra√ß√£o conclu√≠da com sucesso!');
        }

        async function calibrateExpression(expression) {
            return new Promise((resolve) => {
                progressContainer.classList.remove('hidden');
                updateProgress(0, `Fa√ßa uma express√£o ${expression}...`);
                
                let count = 0;
                const interval = setInterval(() => {
                    count += 5;
                    updateProgress(count, `Mantenha a express√£o ${expression}... (${5 - count/20}s)`);
                    
                    if (count >= 100) {
                        clearInterval(interval);
                        captureCalibrationData(expression);
                        resolve();
                    }
                }, 250);
            });
        }

        function captureCalibrationData(expression) {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            calibrationData[expression] = {
                facialData: getFacialLandmarks(canvas),
                timestamp: new Date().toISOString()
            };
        }

        // Visualiza√ß√£o de Resultados
        function completeAnalysis() {
            clearInterval(analysisInterval);
            
            // Dados simulados para demonstra√ß√£o
            const results = {
                emotions: {
                    happiness: Math.random() * 0.8,
                    sadness: Math.random() * 0.6,
                    anger: Math.random() * 0.4,
                    neutral: Math.random() * 0.3,
                    surprise: Math.random() * 0.5
                },
                voiceAnalysis: {
                    tone: ['positive', 'neutral', 'negative'][Math.floor(Math.random() * 3)],
                    keywords: ['feliz', 'bom', 'dia'][Math.floor(Math.random() * 3)]
                },
                heartRate: Math.floor(Math.random() * 40) + 60,
                timestamp: new Date().toISOString()
            };
            
            displayResults(results);
            startBtn.disabled = false;
        }

        function displayResults(data) {
            // Atualiza barras de intensidade
            emotionBars.innerHTML = '';
            for (const [emotion, value] of Object.entries(data.emotions)) {
                if (value < config.minConfidence) continue;
                
                const percentage = Math.round(value * 100);
                emotionBars.innerHTML += `
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="capitalize">${emotion}</span>
                            <span>${percentage}%</span>
                        </div>
                        <div class="emotion-bar ${emotion}" style="width: ${percentage}%"></div>
                    </div>
                `;
            }
            
            // Atualiza gr√°fico
            updateChart(data.emotions);
            
            // Detalhes adicionais
            detailedResults.innerHTML = `
                <div class="bg-gray-700 bg-opacity-50 p-4 rounded-lg">
                    <h4 class="font-bold mb-2">An√°lise Vocal</h4>
                    <p>Tom: <span class="capitalize">${data.voiceAnalysis.tone}</span></p>
                    <p>Palavras-chave: ${data.voiceAnalysis.keywords || 'Nenhuma detectada'}</p>
                </div>
                <div class="bg-gray-700 bg-opacity-50 p-4 rounded-lg">
                    <h4 class="font-bold mb-2">Dados Fisiol√≥gicos</h4>
                    <p>Frequ√™ncia card√≠aca: ${data.heartRate} bpm</p>
                    <p>N√≠vel de estresse: ${data.heartRate > 85 ? 'Elevado' : 'Normal'}</p>
                </div>
            `;
            
            progressContainer.classList.add('hidden');
            resultsDiv.classList.remove('hidden');
        }

        function updateChart(emotionData) {
            if (emotionChart) emotionChart.destroy();
            
            const labels = Object.keys(emotionData).map(e => e.charAt(0).toUpperCase() + e.slice(1));
            const data = Object.values(emotionData).map(v => v * 100);
            const backgroundColors = [
                'rgba(74, 222, 128, 0.7)',
                'rgba(96, 165, 250, 0.7)',
                'rgba(248, 113, 113, 0.7)',
                'rgba(156, 163, 175, 0.7)',
                'rgba(250, 204, 21, 0.7)'
            ];
            
            emotionChart = new Chart(emotionChartCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Intensidade Emocional (%)',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors.map(c => c.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // Utilit√°rios
        function updateProgress(percent, text) {
            progressBar.style.width = `${percent}%`;
            progressPercent.textContent = `${percent}%`;
            progressText.textContent = text;
        }

        function applyCalibration(emotion, value) {
            if (!calibrationData[emotion]) return value;
            // Aplica ajustes com base nos dados de calibra√ß√£o
            return value * 1.2; // Aumenta sensibilidade para emo√ß√µes calibradas
        }

        // Carrega calibra√ß√£o salva
        function loadCalibration() {
            const saved = localStorage.getItem('calibrationData');
            if (saved) calibrationData = JSON.parse(saved);
        }

        // Inicializa
        loadCalibration();
    </script>
</body>
</html>
