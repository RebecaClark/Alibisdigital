<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Teste o Scanner Emocional da Álibis Digital para um diagnóstico emocional detalhado e descubra planos para bem-estar.">
  <meta name="keywords" content="scanner emocional, criar álibi, apoio emocional, medical IA, bem-estar, estresse">
  <meta name="author" content="Álibis Digital">
  <title>Scanner Emocional - Álibis Digital</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <style>
    html { scroll-behavior: smooth; }
    body { 
      position: relative; 
      overflow-x: hidden; 
      min-height: 100vh; 
      color: #e5e7eb; 
      text-shadow: 0 0.5px rgba(0, 0, 0, 0.5); 
      font-family: Arial, sans-serif;
    }
    #particles-js { 
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
      background: #0b1120;
    }
    #particles-fallback {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
      background: #0b1120;
      display: none;
      color: #e5e7eb;
      text-align: center;
      padding-top: 20%;
      font-size: 1.2rem;
    }
    .fade-in { animation: fadeIn 1s ease-in-out; }
    .slide-in-left { animation: slideInLeft 1.2s ease-in-out; }
    .slide-in-right { animation: slideInRight 1.2s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideInLeft { from { opacity: 0; transform: translateX(-60px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes slideInRight { from { opacity: 0; transform: translateX(60px); } to { opacity: 1; transform: translateX(0); } }
    .shine { position: relative; overflow: hidden; }
    .shine::after { 
      content: ''; 
      position: absolute; 
      top: -60%; 
      left: -60%; 
      width: 220%; 
      height: 220%; 
      background: linear-gradient(45deg, rgba(255,255,255,0), rgba(255,255,255,0.2), rgba(255,255,255,0)); 
      transform: rotate(20deg); 
      animation: shine 4s infinite linear; 
    }
    @keyframes shine { 
      0% { transform: translateX(-120%) rotate(20deg); } 
      100% { transform: translateX(120%) rotate(20deg); } 
    }
    .futuristic-btn { 
      background: linear-gradient(45deg, #7C3AED, #22d3ee); 
      box-shadow: 0 0 15px #22d3ee; 
      transition: transform 0.3s ease, box-shadow 0.3s ease; 
      animation: neonPulse 1.5s infinite alternate; 
    }
    .futuristic-btn:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 0 25px #22d3ee, 0 0 35px #22d3ee; 
    }
    @keyframes neonPulse { 
      0% { box-shadow: 0 0 5px #22d3ee, 0 0 10px #22d3ee; } 
      100% { box-shadow: 0 0 15px #22d3ee, 0 0 25px #22d3ee; } 
    }
    .holo-nav {
      background: rgba(17, 24, 39, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      animation: holoGlow 2s infinite alternate;
    }
    @keyframes holoGlow {
      0% { box-shadow: 0 0 10px #22d3ee, 0 0 20px #22d3ee; }
      100% { box-shadow: 0 0 20px #22d3ee, 0 0 30px #22d3ee; }
    }
    .holo-nav a, .holo-nav button { transition: color 0.3s ease; }
    .holo-nav a:hover, .holo-nav button:hover { 
      color: #22d3ee; 
      text-shadow: 0 0 5px #22d3ee; 
    }
    .dropdown-menu {
      background: rgba(31, 41, 55, 0.9);
      border: 1px solid #22d3ee;
      box-shadow: 0 0 10px #22d3ee;
      border-radius: 8px;
      padding: 8px 0;
      position: absolute;
      top: 100%;
      left: 0;
      display: none;
      width: 200px;
    }
    .dropdown-menu a {
      display: block;
      padding: 8px 16px;
      color: #e5e7eb;
      transition: all 0.3s ease;
    }
    .dropdown-menu a:hover {
      background: rgba(55, 65, 81, 0.8);
      color: #22d3ee;
    }
    .dropdown:hover .dropdown-menu { display: block; }
    .dropdown-menu-mobile {
      background: rgba(31, 41, 55, 0.9);
      border: 1px solid #22d3ee;
      box-shadow: 0 0 10px #22d3ee;
      border-radius: 8px;
      padding: 8px 0;
      width: 100%;
      position: static;
    }
    .dropdown-menu-mobile a {
      display: block;
      padding: 8px 16px;
      color: #e5e7eb;
      transition: all 0.3s ease;
    }
    .dropdown-menu-mobile a:hover {
      background: rgba(55, 65, 81, 0.8);
      color: #22d3ee;
    }
    .animate-on-scroll {
      opacity: 0;
      transform: translateY(50px);
      transition: opacity 0.9s ease-out, transform 0.9s ease-out;
    }
    .animate-on-scroll.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .neon-box {
      background: linear-gradient(45deg, #1e1b4b, #22d3ee);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 10px #22d3ee;
      animation: fadeIn 1s ease-in-out;
      max-width: 600px;
      margin: 0 auto;
      text-align: left;
    }
    .loading-dots::after {
      content: '';
      display: inline-block;
      width: 1em;
      height: 1em;
      animation: dots 1.5s steps(3, end) infinite;
    }
    @keyframes dots {
      0% { content: '.'; }
      33% { content: '..'; }
      66% { content: '...'; }
      100% { content: '.'; }
    }
    video {
      width: 320px;
      height: 240px;
      max-width: 100%;
      margin-left: auto;
      margin-right: auto;
      border-radius: 0.75rem;
      box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.2);
      border: 1px solid #22d3ee;
    }
    .video-placeholder {
      width: 320px;
      height: 240px;
      max-width: 100%;
      background: #1f2937;
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
      border: 1px solid #22d3ee;
    }
    .testimonial-card {
      background: rgba(31, 41, 55, 0.9);
      border: 1px solid #22d3ee;
      border-radius: 10px;
      padding: 20px;
      margin: 10px;
      box-shadow: 0 0 10px #22d3ee;
    }
    .testimonial-img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 2px solid #22d3ee;
      margin-right: 15px;
    }
    #chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
    }
    #chat-bubble {
      background: linear-gradient(45deg, #7C3AED, #22d3ee);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 15px #22d3ee;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    #chat-window {
      display: none;
      background: rgba(17, 24, 39, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid #22d3ee;
      border-radius: 15px;
      width: 300px;
      height: 400px;
      position: absolute;
      bottom: 80px;
      right: 0;
      box-shadow: 0 0 20px #22d3ee;
    }
    #chat-messages {
      height: 300px;
      overflow-y: auto;
      padding: 10px;
      color: #e5e7eb;
    }
    #chat-input {
      background: rgba(55, 65, 81, 0.8);
      border: 1px solid #22d3ee;
      border-radius: 20px;
      padding: 10px;
      width: 100%;
      color: white;
    }
    .listening-indicator {
      display: none;
      color: #22d3ee;
      font-size: 0.9rem;
      text-align: center;
      margin-top: 5px;
    }
    .listening-indicator.active { display: block; }
    @media (max-width: 768px) {
      h1 { font-size: 2rem; }
      h2 { font-size: 1.5rem; }
      p { font-size: 0.9rem; }
      .max-w-4xl { max-width: 100%; padding: 0 1rem; }
      .max-w-6xl { max-width: 100%; padding: 0 1rem; }
      .grid { grid-template-columns: 1fr; }
      .flex { flex-direction: column; }
      .futuristic-btn { width: 100%; margin-bottom: 0.5rem; padding: 0.5rem 1rem; font-size: 0.9rem; }
      video, .video-placeholder { width: 280px; height: 210px; max-width: 90vw; }
      .scanner-container { padding: 1rem; max-height: 80vh; }
      section#scanner, section#emotion-intro { padding-top: 1.5rem; padding-bottom: 1.5rem; }
      #chat-window { width: 90%; right: 5%; height: 350px; }
      #chat-messages { height: 250px; }
      .testimonial-card { padding: 15px; margin: 5px; }
      .testimonial-img { width: 50px; height: 50px; }
    }
    @media (max-width: 480px) {
      h1 { font-size: 1.8rem; }
      h2 { font-size: 1.3rem; }
      p { font-size: 0.85rem; }
      video, .video-placeholder { width: 240px; height: 180px; }
      .futuristic-btn { font-size: 0.8rem; }
      .neon-box { padding: 15px; }
    }
  </style>
</head>
<body class="bg-transparent text-white font-sans">
  <div id="particles-js"></div>
  <div id="particles-fallback">Particle effect failed to load. Please check your internet connection.</div>

  <header class="holo-nav fixed top-0 left-0 w-full z-50 transition-shadow duration-300">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center">
        <a href="/index.html" aria-label="Página inicial da Álibis Digital">
          <img src="/assets/logo.png" alt="Logo da Álibis Digital" class="h-10 w-auto" onerror="this.src='https://via.placeholder.com/100x40?text=Logo'; console.error('Erro ao carregar logo.png')">
        </a>
      </div>
      <div class="flex items-center">
        <div class="md:hidden">
          <button id="hamburger-menu" class="text-white focus:outline-none p-2 rounded" aria-label="Abrir menu de navegação">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
      <nav id="navbar" class="hidden md:flex space-x-6 text-sm items-center">
        <div class="dropdown relative">
          <button class="hover:text-[#22d3ee] transition flex items-center" aria-label="Abrir menu de serviços">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path>
            </svg>
            <span>Serviços</span>
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div class="dropdown-menu">
            <a href="/scanner.html" class="hover:text-[#22d3ee] transition">Scanner com IA</a>
            <a href="/apoio-emocional.html" class="hover:text-[#22d3ee] transition">Avaliação Emocional</a>
            <a href="/medical-ai.html" class="hover:text-[#22d3ee] transition">Diagnóstico Médico</a>
            <a href="/alibi.html" class="hover:text-[#22d3ee] transition">Criar Álibi</a>
          </div>
        </div>
        <a href="/blog.html" class="hover:text-[#22d3ee] transition">Blog</a>
        <a href="/planos.html" class="hover:text-[#22d3ee] transition">Planos</a>
        <a href="/suporte.html" class="hover:text-[#22d3ee] transition">Suporte</a>
        <a href="/planos.html" class="futuristic-btn text-white py-2 px-4 rounded-full text-sm font-semibold" aria-label="Teste Grátis">🔍 Teste Grátis</a>
      </nav>
    </div>
    <div id="mobile-menu" class="md:hidden bg-gray-800 bg-opacity-95 w-full hidden py-4">
      <nav class="flex flex-col items-center space-y-4">
        <div class="w-full">
          <button id="services-toggle" class="text-white py-2 px-4 text-lg w-full text-center hover:bg-gray-700 rounded flex justify-between items-center">
            <span>Serviços</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div id="services-menu" class="dropdown-menu-mobile hidden">
            <a href="/scanner.html" class="hover:bg-gray-700">Scanner com IA</a>
            <a href="/apoio-emocional.html" class="hover:bg-gray-700">Avaliação Emocional</a>
            <a href="/medical-ai.html" class="hover:bg-gray-700">Diagnóstico Médico</a>
            <a href="/alibi.html" class="hover:bg-gray-700">Criar Álibi</a>
          </div>
        </div>
        <a href="/blog.html" class="text-white py-2 px-4 text-lg w-full text-center hover:bg-gray-700 rounded">Blog</a>
        <a href="/planos.html" class="text-white py-2 px-4 text-lg w-full text-center hover:bg-gray-700 rounded">Planos</a>
        <a href="/suporte.html" class="text-white py-2 px-4 text-lg w-full text-center hover:bg-gray-700 rounded">Suporte</a>
        <a href="/planos.html" class="futuristic-btn text-white py-2 px-4 rounded-full text-lg w-full text-center" aria-label="Teste Grátis">🔍 Teste Grátis</a>
      </nav>
    </div>
  </header>
  <div class="h-20"></div>

  <section id="hero" class="text-white text-center py-20 px-6 relative animate-on-scroll">
    <div class="max-w-6xl mx-auto">
      <h1 class="text-5xl md:text-6xl font-serif font-bold mb-6 leading-tight fade-in">Transforme Sua Vida com o Scanner Emocional</h1>
      <p class="text-lg md:text-xl text-gray-300 mb-10 fade-in">Descubra seu estado emocional com IA avançada. Teste grátis agora!</p>
      <div>
        <a href="/relatorios-avancados.html" class="futuristic-btn text-white font-bold py-3 px-8 rounded-full" aria-label="Obter Relatórios Avançados">🔍 Obter Relatórios Avançados</a>
      </div>
    </div>
  </section>

  <section class="py-10 px-6 text-center animate-on-scroll" id="emotion-intro">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold mb-6 text-white shine">Entenda Suas Emoções</h2>
      <p class="text-lg mb-6 text-gray-300 fade-in">Nosso scanner analisa expressões faciais, frequência cardíaca e tom de voz para identificar emoções como felicidade, tristeza, raiva, medo, surpresa, nojo e neutralidade. Cada emoção reflete um estado interno único, ajudando você a se conhecer melhor.</p>
      <ul class="text-left text-gray-300 mb-6 space-y-2">
        <li><strong>Felicidade:</strong> Sorrisos largos, olhos brilhantes e tom animado indicam alegria e bem-estar.</li>
        <li><strong>Tristeza:</strong> Sobrancelhas caídas, boca curvada e voz baixa sugerem melancolia ou introspecção.</li>
        <li><strong>Raiva:</strong> Sobrancelhas franzidas, lábios apertados e tom elevado mostram tensão ou frustração.</li>
        <li><strong>Medo:</strong> Olhos arregalados, boca entreaberta e voz trêmula refletem ansiedade ou incerteza.</li>
        <li><strong>Surpresa:</strong> Sobrancelhas erguidas, olhos abertos e tom agudo indicam algo inesperado.</li>
        <li><strong>Nojo:</strong> Nariz enrugado, lábios contraídos e tom de repulsa mostram desagrado.</li>
        <li><strong>Neutralidade:</strong> Expressão relaxada e tom estável podem indicar calma ou concentração.</li>
      </ul>
      <button onclick="document.getElementById('scanner').scrollIntoView({behavior: 'smooth'})" class="futuristic-btn text-white font-bold py-2 px-6 rounded-full text-sm shine" aria-label="Começar o Scanner">Começar o Scanner</button>
    </div>
  </section>

  <section class="py-10 px-6 text-center animate-on-scroll scanner-container" id="scanner">
    <h2 class="text-4xl font-bold mb-6 text-white shine">Seu rosto carrega sinais. Vamos descobrir o que ele diz?</h2>
    <p class="text-lg mb-8 text-gray-300 fade-in">Ative sua câmera e permita acesso a dados biométricos (frequência cardíaca, tom de voz) para um diagnóstico emocional detalhado com idade aparente.</p>
    <div class="flex flex-col items-center mb-4">
      <video id="video" width="320" height="240" autoplay class="rounded-xl shadow-md border border-[#22d3ee]" aria-label="Vídeo da câmera para análise emocional"></video>
      <div id="video-placeholder" class="video-placeholder hidden">Câmera não disponível</div>
      <div id="vr-toggle" class="mt-4">
        <button onclick="toggleVR()" class="futuristic-btn text-white font-bold py-2 px-6 rounded-full text-sm shine" aria-label="Ativar Experiência VR/AR">Ativar Relaxamento VR/AR</button>
      </div>
    </div>
    <div class="flex justify-center mb-4">
      <button onclick="captureAndAnalyze()" class="futuristic-btn text-white font-bold py-2 px-6 rounded-full text-sm shine" aria-label="Analisar Estado Emocional">Analisar Estado Emocional</button>
      <button onclick="initMedicalConsult()" class="futuristic-btn text-white font-bold py-2 px-6 rounded-full text-sm shine ml-4" aria-label="Consultar Médico">Consultar Médico</button>
    </div>
    <div class="testimonials mt-8 max-w-4xl mx-auto">
      <h3 class="text-2xl font-bold mb-4 text-white shine">O que nossos usuários dizem</h3>
      <div class="flex flex-wrap justify-center">
        <div class="testimonial-card flex items-center">
          <img src="https://via.placeholder.com/60" alt="Foto de Ana" class="testimonial-img">
          <div>
            <p class="text-gray-300">"O Scanner mudou minha vida! Descobri o que me estressava e agora vivo mais leve."</p>
            <p class="text-sm text-gray-400 mt-2">- Ana, 34 anos</p>
          </div>
        </div>
        <div class="testimonial-card flex items-center">
          <img src="https://via.placeholder.com/60" alt="Foto de João" class="testimonial-img">
          <div>
            <p class="text-gray-300">"Incrível como a IA me ajudou a entender minhas emoções. Recomendo!"</p>
            <p class="text-sm text-gray-400 mt-2">- João, 29 anos</p>
          </div>
        </div>
      </div>
    </div>
    <div id="scanner-result" class="neon-box mt-6" style="display: none;"></div>
    <div id="vr-container" style="display: none;">
      <p class="text-lg text-gray-300 fade-in">Bem-vindo ao Relaxamento VR/AR! Explore uma caminhada virtual na natureza.</p>
      <!-- Placeholder for future VR/AR integration -->
    </div>
    <canvas id="canvas" width="320" height="240" style="display: none;"></canvas>
  </section>

  <!-- Chat Interativo com Voz -->
  <div id="chat-container">
    <div id="chat-bubble">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
      </svg>
    </div>
    <div id="chat-window">
      <div id="chat-messages"></div>
      <div class="p-4">
        <input id="chat-input" type="text" class="w-full" placeholder="Digite ou fale sua mensagem" aria-label="Digite ou fale sua mensagem">
        <div id="listening-indicator" class="listening-indicator">🎙️ Ouvindo...</div>
      </div>
    </div>
  </div>

  <footer class="bg-[rgba(11,17,32,0.8)] text-gray-400 py-12 animate-on-scroll">
    <div class="max-w-6xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-10 text-sm">
      <div class="slide-in-left">
        <h3 class="text-white text-2xl font-bold mb-4 shine">Álibis Digital</h3>
        <p class="fade-in">Soluções de bem-estar com tecnologia avançada.</p>
      </div>
      <div class="fade-in">
        <h4 class="text-white font-semibold mb-4">Navegue</h4>
        <ul class="space-y-2">
          <li><a href="/index.html" class="hover:text-white transition">Início</a></li>
          <li><a href="/scanner.html" class="hover:text-white transition">Scanner</a></li>
          <li><a href="/blog.html" class="hover:text-white transition">Blog</a></li>
          <li><a href="/medical-ai.html" class="hover:text-white transition">Diagnóstico Médico</a></li>
          <li><a href="/apoio-emocional.html" class="hover:text-white transition">Avaliação Emocional</a></li>
          <li><a href="/alibi.html" class="hover:text-white transition">Criar Álibi</a></li>
          <li><a href="/planos.html" class="hover:text-white transition">Planos</a></li>
          <li><a href="/suporte.html" class="hover:text-white transition">Suporte</a></li>
          <li><a href="/politica-privacidade.html" class="hover:text-white transition">Privacidade</a></li>
        </ul>
      </div>
      <div class="slide-in-right">
        <h4 class="text-white font-semibold mb-4">Contato</h4>
        <ul class="space-y-2">
          <li class="fade-in">E-mail: contato@alibisdigital.com</li>
          <li class="fade-in">WhatsApp: (11) 91234-5678</li>
        </ul>
      </div>
    </div>
    <div class="text-center mt-8">
      <p class="text-sm">© 2025 Álibis Digital. Todos os direitos reservados.</p>
    </div>
  </footer>

  <script>
    console.log('Loading scanner.html at', new Date().toISOString());
    // Inicializar Partículas com Efeito Hexagonal
    function initializeParticles() {
      if (typeof particlesJS !== 'undefined') {
        particlesJS('particles-js', {
          particles: {
            number: { value: 100, density: { enable: true, value_area: 800 } },
            color: { value: '#22d3ee' },
            shape: { type: 'circle' },
            opacity: { value: 0.7, random: true },
            size: { value: 3, random: true },
            line_linked: {
              enable: true,
              distance: 120,
              color: '#22d3ee',
              opacity: 0.4,
              width: 1
            },
            move: { speed: 1, direction: 'none', random: true }
          },
          interactivity: {
            detect_on: 'canvas',
            events: {
              onhover: { enable: true, mode: 'repulse' },
              onclick: { enable: true, mode: 'push' }
            }
          },
          retina_detect: true
        });
        console.log('Particles.js loaded successfully with hexagonal effect');
      } else {
        console.error('particlesJS not loaded - showing fallback');
        document.getElementById('particles-fallback').style.display = 'block';
      }
    }

    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      initializeParticles();
    } else {
      window.addEventListener('DOMContentLoaded', initializeParticles);
    }

    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      particlesJS('particles-js', { particles: { number: { value: 0 } } });
      console.log('Reduced motion detected - particles disabled');
    }

    const apiKey = 'AmoIQKuEFggNsZmeO_Ur50ZZmfSrZ3mX';
    const apiSecret = 'WoRf3C8_IqQhe0Su8coFmOnAB_0nOheY';

    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM carregado, inicializando scanner...');
      const video = document.getElementById('video');
      const placeholder = document.getElementById('video-placeholder');
      const result = document.getElementById('scanner-result');
      const vrContainer = document.getElementById('vr-container');
      
      if (result) {
        result.style.display = 'none';
        result.innerHTML = '';
        console.log('Resultado inicializado como oculto');
      }

      if (video && placeholder) {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(stream => {
            video.srcObject = stream;
            video.classList.remove('hidden');
            placeholder.classList.add('hidden');
            console.log('Câmera inicializada com sucesso');
          })
          .catch(error => {
            console.error('Erro ao acessar a câmera:', error);
            video.classList.add('hidden');
            placeholder.classList.remove('hidden');
            if (result) {
              result.style.display = 'block';
              result.innerHTML = '<p class="fade-in">🚫 Erro: não foi possível acessar a câmera. Permita os acessos e recarregue a página.</p>';
            }
          });
      } else {
        console.error('Elementos de vídeo ou placeholder não encontrados');
      }

      initScrollAnimations();

      const hamburger = document.getElementById('hamburger-menu');
      const mobileMenu = document.getElementById('mobile-menu');
      if (hamburger && mobileMenu) {
        hamburger.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
          console.log('Menu mobile toggled');
        });
      }

      const servicesToggle = document.getElementById('services-toggle');
      const servicesMenu = document.getElementById('services-menu');
      if (servicesToggle && servicesMenu) {
        servicesToggle.addEventListener('click', () => {
          servicesMenu.classList.toggle('hidden');
          console.log('Menu de serviços mobile toggled');
        });
      }

      window.addEventListener('scroll', () => {
        const header = document.querySelector('header');
        if (header) {
          if (window.scrollY > 50) {
            header.classList.add('shadow-lg');
          } else {
            header.classList.remove('shadow-lg');
          }
        }
      });

      // Inicializar Chatbot
      const chatBubble = document.getElementById('chat-bubble');
      const chatWindow = document.getElementById('chat-window');
      const chatMessages = document.getElementById('chat-messages');
      const chatInput = document.getElementById('chat-input');
      const listeningIndicator = document.getElementById('listening-indicator');
      const synth = window.speechSynthesis;
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      let recognition = SpeechRecognition ? new SpeechRecognition() : null;
      let lastUserMessage = '';

      const speak = (text) => {
        if (!synth) return;
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'pt-BR';
        utter.volume = 1.0; // Ensure maximum volume
        utter.rate = 1.0;   // Normal speed
        utter.pitch = 1.0;  // Natural pitch
        synth.cancel();     // Clear any previous speech
        synth.speak(utter);
      };

      const addMessage = (message, isUser = false) => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `p-2 mb-2 rounded-lg ${isUser ? 'bg-[#22d3ee] text-white ml-auto' : 'bg-gray-700 text-gray-200'} max-w-[80%]`;
        messageDiv.textContent = message;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      };

      chatBubble.addEventListener('click', () => {
        chatWindow.style.display = chatWindow.style.display === 'block' ? 'none' : 'block';
        if (chatWindow.style.display === 'block') {
          const welcomeMessage = 'Olá! Acabei de fazer seu pré-diagnóstico emocional. Gostaria de um relatório avançado ou uma consulta médica?';
          addMessage(welcomeMessage, false);
          speak(welcomeMessage);
        }
      });

      chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && chatInput.value.trim()) {
          const userMessage = chatInput.value.trim();
          addMessage(userMessage, true);
          lastUserMessage = userMessage.toLowerCase();
          chatInput.value = '';
          respondToUser(lastUserMessage);
        }
      });

      if (recognition) {
        recognition.lang = 'pt-BR';
        recognition.onstart = () => listeningIndicator.classList.add('active');
        recognition.onend = () => listeningIndicator.classList.remove('active');
        recognition.onresult = (event) => {
          const spokenText = event.results[0][0].transcript;
          chatInput.value = spokenText;
          const eventEnter = new Event('keypress');
          eventEnter.key = 'Enter';
          chatInput.dispatchEvent(eventEnter);
        };
        recognition.onerror = () => {
          listeningIndicator.classList.remove('active');
          addMessage('Desculpe, o reconhecimento de voz não está disponível.', false);
        };
        chatInput.addEventListener('focus', () => recognition.start());
      } else {
        chatInput.addEventListener('focus', () => {
          addMessage('Reconhecimento de voz não disponível neste navegador.', false);
        });
      }

      function respondToUser(message) {
        let response = 'Gostaria de um relatório avançado, uma consulta médica ou um plano básico?';
        if (message.includes('relatório') || message.includes('avançado') || message.includes('detalhado')) {
          response = 'Ótimo! Vamos para os relatórios avançados!';
          setTimeout(() => window.location.href = '/relatorios-avancados.html', 1500);
        } else if (message.includes('médico') || message.includes('consulta')) {
          response = 'Conectando você a um consultor médico...';
          setTimeout(() => initMedicalConsult(), 1500);
        } else if (message.includes('básico') || message.includes('simples')) {
          response = 'Entendido! Vamos para o plano básico.';
          setTimeout(() => window.location.href = '/criar-alibi-basico.html', 1500);
        } else if (message.includes('não') || message.includes('obrigado')) {
          response = 'Tudo bem! Se precisar, estou aqui. Que tal explorar nosso blog?';
          setTimeout(() => window.location.href = '/blog.html', 1500);
        } else if (message.includes('suporte') || message.includes('ajuda')) {
          response = 'Nosso suporte está pronto para ajudar!';
          setTimeout(() => window.location.href = '/suporte.html', 1500);
        }
        setTimeout(() => {
          addMessage(response, false);
          speak(response);
        }, 500);
      }
    });

    function initScrollAnimations() {
      const animatedElements = document.querySelectorAll('.animate-on-scroll');
      function checkIfInView() {
        const windowHeight = window.innerHeight;
        const windowTopPosition = window.scrollY;
        const windowBottomPosition = windowTopPosition + windowHeight;
        animatedElements.forEach(element => {
          const elementHeight = element.offsetHeight;
          const elementTopPosition = element.offsetTop;
          const elementBottomPosition = elementTopPosition + elementHeight;
          if (elementBottomPosition >= windowTopPosition && elementTopPosition <= windowBottomPosition) {
            element.classList.add('visible');
          }
        });
      }
      checkIfInView();
      window.addEventListener('scroll', checkIfInView);
      window.addEventListener('resize', checkIfInView);
    }

    async function captureAndAnalyze() {
      console.log('Iniciando análise facial e biométrica...');
      const canvas = document.getElementById('canvas');
      const video = document.getElementById('video');
      const result = document.getElementById('scanner-result');
      let audioContext = null;
      let analyser = null;
      let stream = null;

      if (!canvas || !video || !result) {
        console.error('Elementos necessários não encontrados:', { canvas, video, result });
        return;
      }

      if (!video.srcObject) {
        console.error('Stream de vídeo não disponível');
        result.style.display = 'block';
        result.innerHTML = '<p class="fade-in">🚫 Erro: câmera não está ativo. Verifique permissões e tente novamente.</p><div class="mt-6"><button onclick="captureAndAnalyze()" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Tentar Novamente</button></div>';
        return;
      }

      window.speechSynthesis.cancel();
      result.style.display = 'block';
      result.innerHTML = '<p class="fade-in">⏳ Analisando expressão facial, frequência cardíaca e tom de voz<span class="loading-dots"></span></p>';

      const captures = [];
      const audioCaptures = [];
      try {
        // Request audio stream only during analysis
        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        const audioStream = audioContext.createMediaStreamSource(stream);
        audioStream.connect(analyser);
        analyser.fftSize = 2048;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        for (let i = 0; i < 2; i++) {
          const context = canvas.getContext('2d');
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          const imageBase64 = canvas.toDataURL('image/jpeg').split(',')[1];
          captures.push(imageBase64);

          analyser.getByteFrequencyData(dataArray);
          const voiceTone = dataArray.reduce((a, b) => a + b) / bufferLength; // Simulação simplificada
          audioCaptures.push(voiceTone);
          await new Promise(resolve => setTimeout(resolve, 100));
        }
      } catch (error) {
        console.error('Erro ao acessar o microfone:', error);
        result.innerHTML = '<p class="fade-in">🚫 Erro: não foi possível acessar o microfone. Tente novamente.</p><div class="mt-6"><button onclick="captureAndAnalyze()" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Tentar Novamente</button></div>';
        return;
      } finally {
        if (stream) {
          stream.getTracks().forEach(track => track.stop());
          if (audioContext) audioContext.close();
        }
      }

      let bestResult = null;
      let maxConfidence = 0;

      for (let i = 0; i < captures.length; i++) {
        const formData = new FormData();
        formData.append('api_key', apiKey);
        formData.append('api_secret', apiSecret);
        formData.append('image_base64', captures[i]);
        formData.append('return_attributes', 'emotion,age');

        try {
          const response = await fetch('https://api-us.faceplusplus.com/facepp/v3/detect', {
            method: 'POST',
            body: formData
          });
          const data = await response.json();
          console.log('Resposta da API Face++:', data);

          if (data.faces && data.faces.length > 0) {
            const face = data.faces[0];
            const emotion = face.attributes.emotion;
            const emotionsSorted = Object.entries(emotion).sort((a, b) => b[1] - a[1]);
            const confidence = emotionsSorted[0][1];
            if (confidence > maxConfidence) {
              maxConfidence = confidence;
              bestResult = { emotion, age: face.attributes.age.value, heartRate: Math.floor(60 + (Math.random() * 40)), voiceTone: audioCaptures[i] };
            }
          }
        } catch (error) {
          console.error('Erro ao analisar captura:', error);
        }
      }

      if (bestResult && maxConfidence >= 50) {
        const { emotion, age, heartRate, voiceTone } = bestResult;
        const emotionsSorted = Object.entries(emotion).sort((a, b) => b[1] - a[1]);
        const primaryEmotion = emotionsSorted[0][0];

        const emotionPortuguese = {
          sadness: 'tristeza',
          anger: 'raiva',
          happiness: 'felicidade',
          surprise: 'surpresa',
          neutral: 'neutra',
          fear: 'medo',
          disgust: 'nojo'
        };

        const primaryEmotionInPortuguese = emotionPortuguese[primaryEmotion] || primaryEmotion;
        const ageRangeMin = Math.max(18, age - 5);
        const ageRangeMax = age + 5;

        let diagnosis = '';
        let triggers = '';
        let suggestion = '';
        let personalizedPlan = '';
        let ctaButtons = '';

        switch (primaryEmotion) {
          case 'happiness':
            diagnosis = `Você está radiante, com uma frequência cardíaca de ${heartRate} bpm e tom de voz animado, refletindo felicidade e leveza.`;
            triggers = 'Pode ser resultado de uma conquista recente, uma conexão social significativa ou um momento de satisfação pessoal.';
            suggestion = 'Aproveite essa energia positiva para se conectar com amigos ou explorar uma atividade criativa.';
            personalizedPlan = 'Plano: 10 minutos de meditação diária e caminhada ao ar livre.';
            break;
          case 'sadness':
            diagnosis = `Sua expressão reflete tristeza, com frequência cardíaca de ${heartRate} bpm e tom de voz baixo, indicando introspecção ou sobrecarga emocional.`;
            triggers = 'Isso pode estar ligado a saudades, estresse acumulado ou uma perda recente.';
            suggestion = 'Experimente meditação guiada por 5 minutos ou escreva seus pensamentos.';
            personalizedPlan = 'Plano: 5 minutos de respiração consciente e consulta com apoio emocional.';
            ctaButtons = '<div class="mt-6"><button onclick="window.location.href=\'/apoio-emocional.html\'" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Explorar Apoio Emocional</button></div>';
            break;
          case 'anger':
            diagnosis = `Sua expressão mostra raiva, com frequência cardíaca de ${heartRate} bpm e tom de voz elevado, sugerindo tensão ou frustração.`;
            triggers = 'Um conflito recente ou obstáculos podem estar influenciando.';
            suggestion = 'Tente respiração 4-4-8 ou uma caminhada.';
            personalizedPlan = 'Plano: 10 minutos de caminhada diária e pausa de telas.';
            ctaButtons = '<div class="mt-6"><button onclick="window.location.href=\'/apoio-emocional.html\'" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Explorar Apoio Emocional</button></div>';
            break;
          case 'fear':
            diagnosis = `Sua expressão sugere medo, com frequência cardíaca de ${heartRate} bpm e tom de voz trêmulo, indicando ansiedade ou incerteza.`;
            triggers = 'Eventos inesperados ou pressões do dia a dia podem estar contribuindo.';
            suggestion = 'Pratique mindfulness por 10 minutos ou ouça música calma.';
            personalizedPlan = 'Plano: 5 minutos de mindfulness e relaxamento VR/AR.';
            ctaButtons = '<div class="mt-6"><button onclick="window.location.href=\'/apoio-emocional.html\'" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Explorar Apoio Emocional</button></div>';
            break;
          case 'surprise':
            diagnosis = `Sua expressão indica surpresa, com frequência cardíaca de ${heartRate} bpm e tom de voz agudo, refletindo algo inesperado.`;
            triggers = 'Uma novidade ou mudança súbita pode ter causado isso.';
            suggestion = 'Explore essa curiosidade ou reflita sobre o evento.';
            personalizedPlan = 'Plano: 10 minutos de reflexão diária.';
            break;
          case 'disgust':
            diagnosis = `Você mostra nojo, com frequência cardíaca de ${heartRate} bpm e tom de voz de repulsa, sugerindo desagrado a algo recente.`;
            triggers = 'Um ambiente desconfortável ou valores feridos podem ser a causa.';
            suggestion = 'Afaste-se do que incomoda e busque algo prazeroso.';
            personalizedPlan = 'Plano: 5 minutos de pausa e música relaxante.';
            ctaButtons = '<div class="mt-6"><button onclick="window.location.href=\'/apoio-emocional.html\'" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Explorar Apoio Emocional</button></div>';
            break;
          case 'neutral':
            diagnosis = `Sua expressão é neutra, com frequência cardíaca de ${heartRate} bpm e tom de voz estável, indicando calma ou concentração.`;
            triggers = 'Você pode estar focado ou em um momento de tranquilidade.';
            suggestion = 'Faça uma pausa com alongamentos se sentir cansaço.';
            personalizedPlan = 'Plano: 5 minutos de alongamento diário.';
            break;
          default:
            diagnosis = `Detectamos ${primaryEmotionInPortuguese} em sua expressão, com frequência cardíaca de ${heartRate} bpm e tom de voz variado.`;
            triggers = 'Isso pode estar ligado a uma experiência recente.';
            suggestion = 'Continue explorando suas emoções.';
            personalizedPlan = 'Plano: Avaliação semanal com o Scanner.';
        }

        result.innerHTML = `
          <p class="fade-in"><strong>Pré-diagnóstico emocional:</strong> ${diagnosis}</p>
          <p class="fade-in mt-2"><strong>Possíveis gatilhos:</strong> ${triggers}</p>
          <p class="fade-in mt-2"><strong>Frequência cardíaca:</strong> ${heartRate} bpm</p>
          <p class="fade-in mt-2"><strong>Tom de voz:</strong> ${voiceTone > 100 ? 'Elevado' : 'Baixo'}</p>
          <p class="fade-in mt-2"><strong>Idade aparente:</strong> Você aparenta ter entre ${ageRangeMin} e ${ageRangeMax} anos (estimativa baseada em IA).</p>
          <p class="fade-in mt-2"><strong>Primeiros passos:</strong> ${suggestion}</p>
          <p class="fade-in mt-2"><strong>Plano personalizado:</strong> ${personalizedPlan}</p>
          <p class="text-sm mt-2 text-gray-300">Nota: Este é um diagnóstico preliminar para autoconhecimento e não substitui avaliação profissional. Dados biométricos são simulados para demonstração.</p>
          ${ctaButtons}
          <div class="mt-6"><a href="/relatorios-avancados.html" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Obter Relatórios Avançados</a></div>
          <div class="mt-4"><a href="/planos.html" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Prosseguir para Assinatura</a></div>
          <div class="mt-4"><a href="/criar-alibi-basico.html" class="text-[#22d3ee] font-semibold hover:underline shine">Prefere um plano básico? Clique aqui</a></div>
          <div class="mt-6"><button onclick="captureAndAnalyze()" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Novo Diagnóstico</button></div>
        `;
        speak(`${diagnosis} ${triggers} Frequência cardíaca: ${heartRate} bpm. Tom de voz: ${voiceTone > 100 ? 'elevado' : 'baixo'}. Você aparenta ter entre ${ageRangeMin} e ${ageRangeMax} anos. ${suggestion} Seu plano: ${personalizedPlan}`);
      } else {
        result.innerHTML = '<p class="fade-in">🤔 Não conseguimos detectar uma expressão clara. Tente centralizar o rosto, melhorar a iluminação ou ajustar sua posição.</p><div class="mt-6"><button onclick="captureAndAnalyze()" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Tentar Novamente</button></div>';
        speak('Não conseguimos capturar uma expressão clara. Tente ajustar a iluminação ou a posição do rosto.');
      }
    }

    function toggleVR() {
      const vrContainer = document.getElementById('vr-container');
      vrContainer.style.display = vrContainer.style.display === 'block' ? 'none' : 'block';
      if (vrContainer.style.display === 'block') {
        speak('Bem-vindo ao Relaxamento VR/AR! A integração VR/AR ainda está em desenvolvimento.');
      }
    }

    function initMedicalConsult() {
      const result = document.getElementById('scanner-result');
      result.style.display = 'block';
      result.innerHTML = '<p class="fade-in">⏳ Conectando a um consultor médico licenciado via telehealth...</p><p class="text-sm mt-2 text-gray-300">Seus dados são protegidos por criptografia e cumprem normas de privacidade (GDPR, HIPAA).</p><div class="mt-6"><button onclick="cancelMedicalConsult()" class="futuristic-btn text-white font-bold px-6 py-2 rounded-full text-sm shine">Cancelar</button></div>';
      speak('Conectando a um consultor médico. Seus dados estão seguros.');
      // Simulação: redireciona após 3 segundos
      setTimeout(() => window.location.href = '/medical-ai.html', 3000);
    }

    function cancelMedicalConsult() {
      const result = document.getElementById('scanner-result');
      result.style.display = 'none';
      result.innerHTML = '';
      speak('Consulta médica cancelada.');
    }
  </script>
</body>
</html>
