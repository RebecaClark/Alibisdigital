<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Scanner Emocional Avançado MedAI Brasil - Análise de emoções através de reconhecimento facial e vocal">
  <title>Scanner Emocional | MedAI Brasil</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <style>
    :root {
      --primary: #22d3ee;
      --secondary: #7C3AED;
      --dark: #0b1120;
      --darker: #1e1b4b;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--dark), var(--darker));
      color: white;
      position: relative;
      min-height: 100vh;
    }
    #particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
    }
    .gradient-text {
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .gradient-bg {
      background: linear-gradient(45deg, var(--secondary), var(--primary));
    }
    .glass-card {
      background: rgba(17, 24, 39, 0.85);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
    }
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 211, 238, 0.7); }
      70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(34, 211, 238, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 211, 238, 0); }
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .slide-up {
      animation: slideUp 0.5s ease-out;
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .emotion-dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin: 0 2px;
      opacity: 0.7;
      transition: all 0.3s ease;
    }
    .emotion-dot.active {
      transform: scale(1.5);
      opacity: 1;
    }
    .emotion-dot.happy { background-color: #f59e0b; }
    .emotion-dot.sad { background-color: #3b82f6; }
    .emotion-dot.angry { background-color: #ef4444; }
    .emotion-dot.surprise { background-color: #8b5cf6; }
    .emotion-dot.neutral { background-color: #64748b; }
    .emotion-dot.fear { background-color: #d946ef; }
    
    /* Waveform styles */
    .wave-container {
      height: 100px; /* Reduced height */
      margin-bottom: 20px;
      background: rgba(30, 41, 59, 0.5);
      border-radius: 8px;
      overflow: hidden;
    }
    .waveform {
      width: 100%;
      height: 100%;
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
    }
    .modal-content {
      background: rgba(17, 24, 39, 0.95);
      margin: 5% auto;
      padding: 25px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
    }
    .close-modal {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close-modal:hover {
      color: white;
    }
    .explanation-step {
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(30, 41, 59, 0.5);
      border-radius: 8px;
      border-left: 3px solid var(--primary);
    }
    
    /* Video container */
    .video-container {
      position: relative;
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
    }
    #videoElement {
      width: 100%;
      display: block;
    }
    #overlayCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Partículas de Fundo -->
  <div id="particles-js"></div>

  <!-- Cabeçalho -->
  <header class="glass-card fixed top-0 left-0 w-full z-50 shadow-lg">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <a href="/">
          <img src="/assets/logo.jpg" alt="MedAI Brasil" class="h-8">
        </a>
        <a href="/" class="text-2xl font-bold gradient-text">MedAI Emocional</a>
      </div>
      <button id="how-it-works-btn" class="text-white hover:text-[#22d3ee] transition">
        Como funciona
      </button>
    </div>
  </header>

  <!-- Modal de Introdução -->
  <div id="intro-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h2 class="text-2xl font-bold mb-6 gradient-text">Como funciona nosso Scanner Emocional</h2>
      
      <div class="explanation-step slide-up">
        <h3 class="text-xl font-semibold mb-2 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
          </svg>
          Análise Facial
        </h3>
        <p class="text-gray-300">Nosso sistema identifica emoções através de 68 pontos faciais, detectando microexpressões que podem revelar seu estado emocional atual com precisão.</p>
      </div>
      
      <div class="explanation-step slide-up">
        <h3 class="text-xl font-semibold mb-2 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd" />
          </svg>
          Análise Vocal
        </h3>
        <p class="text-gray-300">Avaliamos tom, frequência e padrões de fala para complementar o diagnóstico emocional com dados acústicos, identificando nuances na sua voz.</p>
      </div>
      
      <div class="explanation-step slide-up">
        <h3 class="text-xl font-semibold mb-2 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
          </svg>
          Privacidade Garantida
        </h3>
        <p class="text-gray-300">Todas as análises são processadas localmente em seu dispositivo. Nenhum dado de vídeo ou áudio é armazenado em nossos servidores.</p>
      </div>
      
      <button id="start-after-explanation" class="gradient-bg text-white font-bold py-3 px-6 rounded-lg mt-6 w-full pulse-animation">
        Entendi, quero começar
      </button>
    </div>
  </div>

  <!-- Conteúdo Principal -->
  <main class="pt-24 pb-16 px-4 max-w-7xl mx-auto">
    <!-- Área do Scanner -->
    <section class="glass-card p-8 my-8">
      <h2 class="text-3xl font-bold mb-8 gradient-text">Scanner Emocional</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Vídeo e Canvas -->
        <div>
          <div class="video-container">
            <video id="videoElement" autoplay muted playsinline></video>
            <canvas id="overlayCanvas"></canvas>
          </div>
          <button id="startBtn" class="gradient-bg text-white font-bold py-3 px-8 rounded-lg mt-6 w-full text-lg">
            Iniciar Análise
          </button>
        </div>
        
        <!-- Resultados -->
        <div>
          <div class="wave-container">
            <canvas id="waveCanvas" class="waveform"></canvas>
          </div>
          
          <div class="glass-card p-6 mb-6">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd" />
              </svg>
              Emoção Detectada
            </h3>
            <div id="emotion-result" class="flex items-center">
              <div id="emotion-dot" class="w-5 h-5 rounded-full mr-3"></div>
              <span id="emotion-text" class="text-lg font-medium">Aguardando análise...</span>
            </div>
          </div>
          
          <div class="glass-card p-6">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
              </svg>
              Detalhes da Análise
            </h3>
            <div id="details-result" class="text-gray-300">
              <p>Inicie a análise para ver os resultados detalhados do seu estado emocional.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Gráficos -->
    <section class="glass-card p-8 my-8">
      <h2 class="text-3xl font-bold mb-8 gradient-text">Análise Detalhada</h2>
      <canvas id="emotionChart" class="w-full h-96"></canvas>
    </section>
  </main>

  <!-- Rodapé -->
  <footer class="bg-gray-900 py-8 px-4">
    <div class="max-w-7xl mx-auto text-center">
      <p class="text-gray-400">© 2023 MedAI Brasil. Todos os direitos reservados.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script>
    // Inicializar partículas
    particlesJS('particles-js', {
      particles: {
        number: { value: 80, density: { enable: true, value_area: 800 } },
        color: { value: ['#22d3ee', '#7C3AED', '#ffffff'] },
        shape: { type: 'circle' },
        opacity: { value: 0.5, random: true },
        size: { value: 3, random: true },
        line_linked: { enable: true, distance: 150, color: '#22d3ee', opacity: 0.4, width: 1 },
        move: { enable: true, speed: 3, direction: 'none', random: true, straight: false, out_mode: 'out' }
      },
      interactivity: {
        detect_on: 'canvas',
        events: {
          onhover: { enable: true, mode: 'bubble' },
          onclick: { enable: true, mode: 'push' }
        },
        modes: {
          bubble: { distance: 200, size: 6, duration: 2, opacity: 0.8, speed: 3 },
          push: { particles_nb: 4 }
        }
      }
    });

    // Elementos DOM
    const videoElement = document.getElementById('videoElement');
    const overlayCanvas = document.getElementById('overlayCanvas');
    const waveCanvas = document.getElementById('waveCanvas');
    const startBtn = document.getElementById('startBtn');
    const emotionResult = document.getElementById('emotion-result');
    const emotionText = document.getElementById('emotion-text');
    const emotionDot = document.getElementById('emotion-dot');
    const detailsResult = document.getElementById('details-result');
    const introModal = document.getElementById('intro-modal');
    const closeModal = document.querySelector('.close-modal');
    const howItWorksBtn = document.getElementById('how-it-works-btn');
    const startAfterExplanation = document.getElementById('start-after-explanation');

    // Estados
    let isScanning = false;
    let emotionChart = null;

    // Mostrar modal na primeira visita
    window.addEventListener('DOMContentLoaded', function() {
      const alreadyShown = localStorage.getItem('scannerExplanationSeen');
      if (!alreadyShown) {
        introModal.style.display = 'block';
      }
      
      // Inicializar câmera
      initCamera();
      
      // Inicializar gráfico vazio
      initEmotionChart();
    });

    // Inicializar câmera
    async function initCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        videoElement.srcObject = stream;
        
        // Ajustar canvas overlay para acompanhar o vídeo
        videoElement.onloadedmetadata = () => {
          overlayCanvas.width = videoElement.videoWidth;
          overlayCanvas.height = videoElement.videoHeight;
        };
      } catch (err) {
        console.error("Erro ao acessar a câmera:", err);
        alert("Não foi possível acessar a câmera. Por favor, verifique as permissões.");
      }
    }

    // Inicializar gráfico de emoções
    function initEmotionChart() {
      const ctx = document.getElementById('emotionChart').getContext('2d');
      emotionChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Felicidade', 'Tristeza', 'Raiva', 'Surpresa', 'Neutro', 'Medo'],
          datasets: [{
            label: 'Intensidade',
            data: [0, 0, 0, 0, 0, 0],
            backgroundColor: [
              'rgba(245, 158, 11, 0.7)',
              'rgba(59, 130, 246, 0.7)',
              'rgba(239, 68, 68, 0.7)',
              'rgba(139, 92, 246, 0.7)',
              'rgba(100, 116, 139, 0.7)',
              'rgba(217, 70, 239, 0.7)'
            ],
            borderColor: [
              'rgba(245, 158, 11, 1)',
              'rgba(59, 130, 246, 1)',
              'rgba(239, 68, 68, 1)',
              'rgba(139, 92, 246, 1)',
              'rgba(100, 116, 139, 1)',
              'rgba(217, 70, 239, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                color: '#E5E7EB'
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            },
            x: {
              ticks: {
                color: '#E5E7EB'
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }

    // Iniciar análise
    startBtn.addEventListener('click', function() {
      if (isScanning) {
        stopAnalysis();
      } else {
        startAnalysis();
      }
    });

    // Iniciar análise
    function startAnalysis() {
      isScanning = true;
      startBtn.textContent = 'Parar Análise';
      startBtn.classList.remove('gradient-bg');
      startBtn.classList.add('bg-red-600');
      
      // Simular análise (em produção seria análise real)
      simulateAnalysis();
      
      // Iniciar animação da onda
      animateWave();
    }

    // Parar análise
    function stopAnalysis() {
      isScanning = false;
      startBtn.textContent = 'Iniciar Análise';
      startBtn.classList.add('gradient-bg');
      startBtn.classList.remove('bg-red-600');
      
      // Limpar overlay
      const ctx = overlayCanvas.getContext('2d');
      ctx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
    }

    // Simular análise (substituir por análise real em produção)
    function simulateAnalysis() {
      if (!isScanning) return;
      
      // Emoções possíveis
      const emotions = [
        { name: 'happy', label: 'Felicidade', color: '#f59e0b', description: 'Você parece estar se sentindo feliz ou contente. Expressões positivas foram detectadas em seu rosto.' },
        { name: 'sad', label: 'Tristeza', color: '#3b82f6', description: 'Seu estado emocional sugere tristeza ou melancolia. Isso pode ser uma resposta normal a eventos recentes.' },
        { name: 'angry', label: 'Raiva', color: '#ef4444', description: 'Detectamos sinais de raiva ou frustração. Técnicas de respiração podem ajudar a acalmar o sistema nervoso.' },
        { name: 'surprise', label: 'Surpresa', color: '#8b5cf6', description: 'Você parece estar surpreso ou impressionado. Expressões de surpresa foram claramente identificadas.' },
        { name: 'neutral', label: 'Neutro', color: '#64748b', description: 'Seu estado emocional parece neutro ou equilibrado. Nenhuma emoção forte foi detectada.' },
        { name: 'fear', label: 'Medo', color: '#d946ef', description: 'Identificamos possíveis sinais de medo ou ansiedade. Técnicas de grounding podem ajudar a acalmar.' }
      ];
      
      // Selecionar emoção aleatória (simulação)
      const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
      
      // Atualizar UI
      emotionDot.style.backgroundColor = randomEmotion.color;
      emotionText.textContent = randomEmotion.label;
      detailsResult.innerHTML = `<p class="mb-2">${randomEmotion.description}</p>
                               <p class="text-sm text-gray-400">Confiança: ${Math.floor(Math.random() * 30) + 70}%</p>`;
      
      // Atualizar gráfico com dados simulados
      updateChartWithRandomData();
      
      // Desenhar pontos faciais simulados
      drawFacialPoints(randomEmotion.name);
      
      // Continuar análise até ser parada
      setTimeout(simulateAnalysis, 3000);
    }

    // Desenhar pontos faciais simulados
    function drawFacialPoints(emotion) {
      const ctx = overlayCanvas.getContext('2d');
      ctx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
      
      // Configurações baseadas na emoção
      let pointColor, lineColor;
      switch(emotion) {
        case 'happy':
          pointColor = 'rgba(245, 158, 11, 0.8)';
          lineColor = 'rgba(245, 158, 11, 0.4)';
          break;
        case 'sad':
          pointColor = 'rgba(59, 130, 246, 0.8)';
          lineColor = 'rgba(59, 130, 246, 0.4)';
          break;
        case 'angry':
          pointColor = 'rgba(239, 68, 68, 0.8)';
          lineColor = 'rgba(239, 68, 68, 0.4)';
          break;
        case 'fear':
          pointColor = 'rgba(217, 70, 239, 0.8)';
          lineColor = 'rgba(217, 70, 239, 0.4)';
          break;
        default:
          pointColor = 'rgba(139, 92, 246, 0.8)';
          lineColor = 'rgba(139, 92, 246, 0.4)';
      }
      
      // Desenhar pontos faciais simulados
      const points = [];
      for (let i = 0; i < 68; i++) {
        const x = overlayCanvas.width/2 + (Math.random() - 0.5) * overlayCanvas.width/2;
        const y = overlayCanvas.height/2 + (Math.random() - 0.5) * overlayCanvas.height/2;
        points.push({x, y});
        
        ctx.fillStyle = pointColor;
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, Math.PI * 2);
        ctx.fill();
      }
      
      // Desenhar linhas conectando alguns pontos
      ctx.strokeStyle = lineColor;
      ctx.lineWidth = 1;
      
      // Contorno do rosto
      for (let i = 0; i < 16; i++) {
        ctx.beginPath();
        ctx.moveTo(points[i].x, points[i].y);
        ctx.lineTo(points[(i+1)%17].x, points[(i+1)%17].y);
        ctx.stroke();
      }
    }

    // Atualizar gráfico com dados aleatórios
    function updateChartWithRandomData() {
      if (!emotionChart) return;
      
      const newData = emotionChart.data.datasets[0].data.map(() => 
        Math.floor(Math.random() * 70) + 30
      );
      
      emotionChart.data.datasets[0].data = newData;
      emotionChart.update();
    }

    // Animar onda de voz
    function animateWave() {
      if (!isScanning) return;
      
      const ctx = waveCanvas.getContext('2d');
      waveCanvas.width = waveCanvas.offsetWidth;
      waveCanvas.height = waveCanvas.offsetHeight;
      
      ctx.clearRect(0, 0, waveCanvas.width, waveCanvas.height);
      
      ctx.strokeStyle = '#22d3ee';
      ctx.lineWidth = 2;
      ctx.beginPath();
      
      const centerY = waveCanvas.height / 2;
      const amplitude = waveCanvas.height / 3;
      
      for (let x = 0; x < waveCanvas.width; x++) {
        const y = centerY + amplitude * Math.sin(x * 0.05 + Date.now() * 0.005);
        
        if (x === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      }
      
      ctx.stroke();
      
      requestAnimationFrame(animateWave);
    }

    // Modal de explicação
    howItWorksBtn.addEventListener('click', function() {
      introModal.style.display = 'block';
    });

    closeModal.addEventListener('click', function() {
      introModal.style.display = 'none';
      localStorage.setItem('scannerExplanationSeen', 'true');
    });

    startAfterExplanation.addEventListener('click', function() {
      introModal.style.display = 'none';
      localStorage.setItem('scannerExplanationSeen', 'true');
      startAnalysis();
    });

    // Fechar modal ao clicar fora
    window.addEventListener('click', function(event) {
      if (event.target === introModal) {
        introModal.style.display = 'none';
        localStorage.setItem('scannerExplanationSeen', 'true');
      }
    });
  </script>
</body>
</html>
