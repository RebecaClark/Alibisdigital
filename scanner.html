<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Scanner Emocional com IA - Teste Gr√°tis">
    <title>Scanner Emocional</title>
    <!-- Favicon inline para evitar erro 404 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üòä</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dsp.js/1.0.0/dsp.min.js"></script>
    <style>
        html { scroll-behavior: smooth; }
        body {
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
            background: transparent;
        }
        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: linear-gradient(135deg, #0b1120, #1e1b4b, #2e1065);
        }
        .fade-in { animation: fadeIn 1s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .pulse { animation: pulse 2s infinite ease-in-out; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .futuristic-btn {
            position: relative;
            display: inline-block;
            background: linear-gradient(45deg, #7C3AED, #22d3ee);
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2), 0 0 8px #22d3ee;
            transition: transform 0.3s ease;
        }
        .futuristic-btn:hover { transform: translateY(-3px); }
        .neon-box {
            background: linear-gradient(45deg, #0a1f2e, #00ccff);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
            max-width: 500px;
            margin: 0 auto;
            backdrop-filter: blur(5px);
        }
        .progress-bar { width: 100%; background: #1a1a1a; border-radius: 5px; overflow: hidden; margin-top: 10px; }
        .progress { height: 8px; background: #22d3ee; width: 0; transition: width 0.3s ease; }
    </style>
</head>
<body>
    <div id="particles-js"></div>

    <section class="container mx-auto px-4 py-16 text-center">
        <h1 class="text-4xl font-bold text-white mb-4 fade-in">Scanner Emocional com IA</h1>
        <p class="text-lg text-gray-300 mb-8 fade-in">Permita o acesso √† c√¢mera e microfone para an√°lise</p>
        
        <div class="flex justify-center mb-6">
            <video id="video" width="320" height="240" autoplay muted class="rounded-lg border-2 border-[#22d3ee] pulse"></video>
        </div>
        
        <button id="analyze-button" class="futuristic-btn font-bold mb-4">Iniciar An√°lise</button>
        
        <div id="result" class="neon-box mt-4 hidden"></div>
        
        <div id="progress-container" class="mt-4 hidden">
            <p id="progress-text" class="text-white">Analisando...</p>
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
        </div>
    </section>

    <script>
        // Configura√ß√µes
        const ANALYSIS_TIMEOUT = 45000; // 45 segundos timeout
        
        // Inicializa√ß√£o do Particles.js com a nova sintaxe (corrigindo o warning)
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: '#22d3ee' },
                shape: { type: 'circle' },
                opacity: { value: 0.3, random: true },
                size: { value: 2, random: true },
                line_linked: { enable: true, distance: 100, color: '#22d3ee', opacity: 0.2, width: 1 },
                move: { enable: true, speed: 1, direction: 'none', random: false, straight: false, out_mode: 'out' }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: { enable: true, mode: 'repulse' },
                    onclick: { enable: true, mode: 'push' },
                    resize: true
                },
                modes: {
                    repulse: { distance: 100 },
                    push: { particles_nb: 4 }
                }
            }
        });

        // Elementos UI
        const video = document.getElementById('video');
        const analyzeButton = document.getElementById('analyze-button');
        const resultDiv = document.getElementById('result');
        const progressContainer = document.getElementById('progress-container');
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress');
        const canvas = document.createElement('canvas');
        canvas.width = 320;
        canvas.height = 240;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', async () => {
            analyzeButton.addEventListener('click', startAnalysis);
            await initializeCamera();
        });

        async function initializeCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
            } catch (err) {
                showError("‚ùå Erro ao acessar a c√¢mera. Verifique as permiss√µes.");
            }
        }

        async function startAnalysis() {
            try {
                analyzeButton.disabled = true;
                showProgress("Iniciando an√°lise...");
                
                // An√°lise facial
                updateProgress(25, "Analisando express√µes faciais...");
                const facialData = await analyzeFace();
                
                // An√°lise de voz
                updateProgress(50, "Aguardando sua fala (10 segundos)...");
                const voiceData = await analyzeVoice();
                
                // Frequ√™ncia card√≠aca
                updateProgress(75, "Calculando batimentos card√≠acos...");
                const bpm = await calculateHeartRate();
                
                // Resultados
                updateProgress(100, "Processando resultados...");
                showResults(facialData, voiceData, bpm);
                
            } catch (error) {
                showError(`‚ö†Ô∏è Erro: ${error.message}`);
            } finally {
                analyzeButton.disabled = false;
            }
        }

        async function analyzeFace() {
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Simula√ß√£o de an√°lise facial (substitua por API real)
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            return {
                emotion: {
                    happiness: Math.random() * 80 + 20,
                    sadness: Math.random() * 30,
                    anger: Math.random() * 20,
                    neutral: Math.random() * 40
                }
            };
        }

        async function analyzeVoice() {
            if (!('webkitSpeechRecognition' in window)) {
                return { sentiment: 'neutro' };
            }

            return new Promise((resolve) => {
                const recognition = new webkitSpeechRecognition();
                recognition.lang = 'pt-BR';
                recognition.maxAlternatives = 1;
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    const sentiment = transcript.includes('feliz') ? 'positivo' : 
                                    transcript.includes('triste') ? 'negativo' : 'neutro';
                    resolve({ sentiment, transcript });
                };
                
                recognition.onerror = () => resolve({ sentiment: 'neutro' });
                recognition.start();
                setTimeout(() => recognition.stop(), 10000);
            });
        }

        async function calculateHeartRate() {
            // Simula√ß√£o de c√°lculo de BPM
            await new Promise(resolve => setTimeout(resolve, 3000));
            return Math.floor(Math.random() * 40) + 60; // 60-100 BPM
        }

        function showResults(facialData, voiceData, bpm) {
            const emotions = facialData.emotion;
            const mainEmotion = Object.keys(emotions).reduce((a, b) => emotions[a] > emotions[b] ? a : b);
            
            const results = {
                happiness: {
                    title: "üòä Felicidade Detectada",
                    message: "Seu estado emocional parece positivo!",
                    suggestion: "Continue cultivando esses sentimentos bons!"
                },
                sadness: {
                    title: "üò¢ Tristeza Detectada",
                    message: "Seus sinais indicam um momento mais dif√≠cil.",
                    suggestion: "Lembre-se que dias melhores vir√£o."
                },
                anger: {
                    title: "üò† Irrita√ß√£o Detectada",
                    message: `Seu BPM est√° em ${bpm}, indicando poss√≠vel estresse.`,
                    suggestion: "Respire fundo e tente relaxar."
                },
                neutral: {
                    title: "üòê Neutralidade Detectada",
                    message: "Sua express√£o est√° equilibrada.",
                    suggestion: "Pratique o autoconhecimento para entender melhor suas emo√ß√µes."
                }
            };

            const result = results[mainEmotion] || results.neutral;
            
            resultDiv.innerHTML = `
                <h3 class="text-xl font-semibold text-white mb-2">${result.title}</h3>
                <p class="text-white mb-2">${result.message}</p>
                <p class="text-white">Tom de voz: ${voiceData.sentiment}</p>
                <p class="text-white">Frequ√™ncia card√≠aca: ${bpm} bpm</p>
                <div class="mt-4 p-4 bg-[rgba(0,0,0,0.3)] rounded">
                    <p class="text-gray-300">üí° ${result.suggestion}</p>
                </div>
                <button onclick="window.location.reload()" class="futuristic-btn mt-4">üîÑ Novo Teste</button>
            `;
            
            resultDiv.classList.remove('hidden');
            progressContainer.classList.add('hidden');
        }

        function showProgress(message) {
            progressText.textContent = message;
            progressContainer.classList.remove('hidden');
            resultDiv.classList.add('hidden');
        }

        function updateProgress(percent, message) {
            progressBar.style.width = `${percent}%`;
            if (message) progressText.textContent = message;
        }

        function showError(message) {
            resultDiv.innerHTML = `
                <div class="text-center text-red-400">
                    <p>${message}</p>
                    <button onclick="startAnalysis()" class="futuristic-btn mt-4">üîÑ Tentar Novamente</button>
                </div>
            `;
            resultDiv.classList.remove('hidden');
            progressContainer.classList.add('hidden');
        }
    </script>
</body>
</html>
